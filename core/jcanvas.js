/**
 * @license jCanvas v13.06.13
 * Copyright 2013 Caleb Evans
 * Released under the MIT license
 */(function(e,t,n,r,i,s,o,u,a){function xn(e){var t=this;an(t,e);return t}function Tn(e){e?an(xn.prototype,e):Tn.prefs=xn.prototype=an({},un);return this}function Nn(e){return ln(e)==="string"}function Cn(e){return e&&e[A]?e[A]("2d"):u}function kn(e,t,n){ln(n[y])===Rt?t[y]=n[y][T](e,n):t[y]=n[y];ln(n[N])===Rt?t[N]=n[N][T](e,n):t[N]=n[N];t.lineWidth=n[vt];if(n.rounded){t.lineCap=qt;t.lineJoin=qt}else{t.lineCap=n.strokeCap;t.lineJoin=n.strokeJoin;t.miterLimit=n.miterLimit}t.shadowOffsetX=n.shadowX;t.shadowOffsetY=n.shadowY;t[gt]=n[gt];t[v]=n[v];t.globalAlpha=n.opacity;t.globalCompositeOperation=n.compositing;n[Dt]&&(t.webkitImageSmoothingEnabled=t.mozImageSmoothingEnabled=n[Dt])}function Ln(e,t,n){if(n.mask){if(n[pt]){e.save();t[O]=an({},t[h]);t[h].masks+=1;e[Xt](t[q].x,t[q].y)?t[h][x]=s:t[h][x]=o}e.clip()}}function An(e,t,n){n[l]&&(t[h][x]===s||t[h][x]===u?n._args[x]=s:n._args[x]=o)}function On(e,t){t._transformed&&e[H]()}function Mn(e,t,n){var r;n[Et]&&t[X]();if(n.shadowStroke&&n[vt]!==0){t.stroke();t.fill();t[v]=d;t[gt]=0;t.stroke()}else{t.fill();n[y]!==d&&(t[v]=d);n[vt]!==0&&t.stroke()}n[Et]||t[X]();On(t,n);if(n.mask||n[l]){r=Bn(e);Ln(t,r,n);An(t,r,n)}}function _n(e,t,n){t[G]=t[Tt]?pn/180:1;e[S](t.x,t.y);e[at](t[at]*t[G]);e[S](-t.x,-t.y);n[at]+=t[at]*t[G]}function Dn(e,t,n){t.scale!==1&&(t[ut]=t[ft]=t.scale);e[S](t.x,t.y);e.scale(t[ut],t[ft]);e[S](-t.x,-t.y);n[ut]*=t[ut];n[ft]*=t[ft]}function Pn(e,t,n){t[S]&&(t[I]=t[F]=t[S]);e[S](t[I],t[F]);n[I]+=t[I];n[F]+=t[F]}function Hn(e,t,n,r){t[G]=t[Tt]?pn/180:1;t._transformed=s;e.save();r===a&&(r=n);if(!t.fromCenter&&!t._centered){t.x+=n/2;t.y+=r/2;t._centered=s}t[at]&&_n(e,t,{});(t.scale!==1||t[ut]!==1||t[ft]!==1)&&Dn(e,t,{});(t[S]||t[I]||t[F])&&Pn(e,t,{})}function Bn(t){var n;if(wn._canvas===t&&wn._data)n=wn._data;else{n=e.data(t,ot);if(!n){n={canvas:t,layers:[],layer:{names:{},groups:{}},intersects:[],drag:{},event:{type:u,x:u,y:u},events:{},transforms:{rotate:0,scaleX:1,scaleY:1,translateX:0,translateY:0,masks:0,withinMask:u},animating:o,animated:u,pixelRatio:1,scaled:!1};n[O]=an({},n[h]);e.data(t,ot,n)}wn._canvas=t;wn._data=n}return n}function jn(e,t,n){var r;for(r in Tn[P])Tn[P][Yt](r)&&Fn(e,t,n,r)}function Fn(e,t,n,r){if(n[r]){r=Qn(r);Tn[P][r](e,t);n[k]=s}}function In(e,t,n){var r,i,o;if(n[wt]||n[V]||n[St]){r=[W,D,et];for(o=0;o<r[f];o+=1){i=Qn(r[o]);Tn[P][i](e,t)}if(!t[P].mouseoutdrag){e.bind("mouseout.jCanvas",function(){var n=t.drag[l];if(n){t.drag={};e[j]();n.dragcancel&&n.dragcancel[T](e[0],n)}});t[P].mouseoutdrag=s}n[k]=s}}function qn(e,t,n,r){var i=t[l].names;r?r[Z]!==a&&Nn(n[Z])&&n[z]!==r[z]&&delete i[n[Z]]:r=n;Nn(r[Z])&&(i[r[Z]]=n)}function Rn(e,t,n,r){var i=t[l][yt],s,o,u;if(!r)r=n;else if(r[z]!==a&&Nn(n[z])&&n[z]!==r[z]){s=i[n[z]];if(s){for(u=0;u<s[f];u+=1)if(s[u]===n){o=u;s[g](u,1);break}s[f]===0&&delete i[n[z]]}}if(Nn(r[z])){s=i[r[z]];if(!s){s=i[r[z]]=[];s[Z]=r[z]}o===a&&(o=s[f]);s[g](o,0,n)}}function Un(e,t,n,r){if(n&&n[w]&&n[B]){r?n._next=r:n._next=u;n[B][T](e,n)}}function zn(t,n,r,i){var o,u,c=r,h;n._args=r;n.canvas=t;if(n[wt]){n[l]=s;n[wt]=s}i?n[B]=i:n.method?n[B]=e.fn[n.method]:n.type?n[B]=e.fn[bn[n.type]]:n[B]=function(){};if(n[l]&&!n._layer){o=e(t);u=o[E]();h=Bn(t);c=new xn(n);qn(o,h,c);Rn(o,h,c);jn(o,h,c);In(o,h,c);c[l]=s;c._layer=s;c[_]===a&&(c[_]=u[f]);u[g](c[_],0,c)}return c}function Wn(e){var t;for(t=0;t<En[f];t+=1)e[En[t]]=e["_"+En[t]]}function Xn(e,t){var n;for(n=0;n<En[f];n+=1){e["_"+En[n]]=e[En[n]];Sn[En[n]]=1;t&&delete e[En[n]]}}function Vn(e,t,n){var r;for(r in n)n[Yt](r)&&cn(n[r])&&(n[r]=n[r][T](e,t,r));return n}function $n(n){var r,s,o=[],u=1;if(n[zt](/^#?\w+$/i)){n===d&&(n="rgba(0,0,0,0)");s=t.head;r=s[ht][Bt];s[ht][Bt]=n;n=e.css(s,Bt);s[ht][Bt]=r}if(n[zt](/^rgb/i)){o=n[zt](/\d+/gi);n[zt](/%/gi)&&(u=2.55);o[0]*=u;o[1]*=u;o[2]*=u;o[3]!==a?o[3]=i(o[3]):o[3]=1}return o}function Jn(e){var t=3,n;if(ln(e[Ht])!=="array"){e[Ht]=$n(e[Ht]);e.end=$n(e.end)}e.now=[];if(e[Ht][3]!==1||e.end[3]!==1)t=4;for(n=0;n<t;n+=1){e.now[n]=e[Ht][n]+(e.end[n]-e[Ht][n])*e.pos;n<3&&(e.now[n]=hn(e.now[n]))}if(e[Ht][3]!==1||e.end[3]!==1)e.now="rgba("+e.now.join(",")+")";else{e.now.slice(0,3);e.now="rgb("+e.now.join(",")+")"}e.elem.nodeName?e.elem[ht][e.prop]=e.now:e.elem[e.prop]=e.now}function Kn(t){var n;for(n=0;n<t[f];n+=1)e.fx.step[t[n]]=Jn}function Qn(e){"ontouchstart"in window&&gn[e]&&(e=gn[e]);return e}function Gn(e){yn[e]&&(e=yn[e]);return e}function Yn(e){Tn[P][e]=function(t,n){e=Qn(e);var r=e===J||e===Y?D:e,i=n[q];if(!n[P][r]){t.bind(r+".jCanvas",function(e){i.x=e[$t];i.y=e.offsetY;i.type=r;i[q]=e;t[j]({resetFire:s});e.preventDefault()});n[P][r]=s}}}function Zn(e,t,n){var r,i,o,a,f,l,c,p;r=n._args;if(r[k]){i=Bn(e);o=i[q];if(o.x!==u&&o.y!==u){l=o.x*i[Pt];c=o.y*i[Pt];a=t[Xt](l,c)||t[Kt]&&t[Kt](l,c)}f=i[h];r.eventX=r.mouseX=o.x;r.eventY=r.mouseY=o.y;r[q]=o[q];p=i[h][at];l=r.eventX;c=r.eventY;if(p!==0){r[tt]=l*vn(-p)-c*dn(-p);r[nt]=c*vn(-p)+l*dn(-p)}else{r[tt]=l;r[nt]=c}r[tt]/=f[ut];r[nt]/=f[ft];!a&&r[Mt]&&!r[xt]&&(r[Ut]=s);a&&i[lt].push(r)}}function er(e,t,n,r,i){t.save();t[m]();t.rect(r[0],i[0],r[1]-r[0],i[1]-i[0]);t.clip();Hn(t,n,0);t[m]()}function tr(e,t,n){n[k]&&Zn(e,t,n);t[H]();Mn(e,t,n)}function nr(e,t){if(t.font)e.font=t.font;else{isNaN(Number(t[b]))||(t[b]+="px");e.font=t[Qt]+" "+t[b]+" "+t[Ft]}}function rr(t,n,r,s){var o,u,a=/\b(\d*\.?\d*)\w\w\b/gi,l,h;if(wn.text===r.text&&wn.font===r.font&&wn[Qt]===r[Qt]&&wn[b]===r[b]&&wn[Ft]===r[Ft]&&wn[At]===r[At]&&wn[rt]===r[rt]){r[p]=wn[p];r[c]=wn[c]}else{r[p]=n[R](s[0])[p];for(l=1;l<s[f];l+=1){h=n[R](s[l])[p];h>r[p]&&(r[p]=h)}o=t[ht][b];if(r.font){u=r.font[zt](a);u&&(t[ht][b]=r.font[zt](a)[0])}else t[ht][b]=r[b];r[c]=i(e.css(t,b))*s[f]*r[rt];t[ht][b]=o}}function ir(e,t){var n=t.text,r=t[At],i=n.split(" "),s,o=[],u="";if(e[R](n)[p]<r||i[f]===1)o=[n];else{for(s=0;s<i[f];s+=1){if(e[R](u+i[s])[p]>r){u!==""&&o.push(u);u=""}u+=i[s];s!==i[f]-1&&(u+=" ")}o.push(u)}o=o.join("\n").replace(/( (\n))|( $)/gi,"$2").split("\n");return o}var f="length",l="layer",c="height",h="transforms",p="width",d="transparent",v="shadowColor",m="beginPath",g="splice",y="fillStyle",b="fontSize",w="visible",E="getLayers",S="translate",x="withinMask",T="call",N="strokeStyle",C="getLayerGroup",k="_event",L="getLayer",A="getContext",O="savedTransforms",M="sHeight",_="index",D="mousemove",P="events",H="restore",B="_method",j="drawLayers",F="translateY",I="translateX",q="event",R="measureText",U="sWidth",z="group",W="mousedown",X="closePath",V="dragGroupWithLayer",$="restoreCanvas",J="mouseover",K="lineTo",Q="drawImage",G="_toRad",Y="mouseout",Z="name",et="mouseup",tt="_eventX",nt="_eventY",rt="lineHeight",it="animating",st="touchstart",ot="jCanvas",ut="scaleX",at="rotate",ft="scaleY",lt="intersects",ct="touchmove",ht="style",pt="autosave",dt="bezierCurveTo",vt="strokeWidth",mt="touchend",gt="shadowBlur",yt="groups",bt="concavity",wt="draggable",Et="closed",St="cursor",xt="_fired",Tt="inDegrees",Nt="_startX",Ct="_startY",kt="dragging",Lt="radius",At="maxWidth",Ot="animated",Mt="_hovered",_t="object",Dt="imageSmoothing",Pt="pixelRatio",Ht="start",Bt="color",jt="drawArc",Ft="fontFamily",It="_animating",qt="round",Rt="function",Ut="_mousedout",zt="match",Wt="drawQuadratic",Xt="isPointInPath",Vt="<canvas />",$t="offsetX",Jt="moveTo",Kt="isPointInStroke",Qt="fontStyle",Gt="load",Yt="hasOwnProperty",Zt="drawEllipse",en="drawPolygon",tn="drawVector",nn="createPattern",rn="complete",sn="drawBezier",on="setLayer",un,an=e.extend,fn=e.inArray,ln=e.type,cn=e.isFunction,hn=r[qt],pn=r.PI,dn=r.sin,vn=r.cos,mn=e[q].fix,gn,yn,bn,wn={},En,Sn;e.fn[ot]=Tn;Tn[P]={};un={align:"center",autosave:s,baseline:"middle",bringToFront:o,ccw:o,closed:o,compositing:"source-over",concavity:0,cornerRadius:0,cropFromCenter:s,disableDrag:o,disableEvents:o,domain:u,draggable:o,group:u,data:{},each:u,end:360,fillStyle:d,font:"",fontStyle:"normal",fontSize:"12pt",fontFamily:"sans-serif",fromCenter:s,fn:u,graph:"y",height:u,imageSmoothing:s,inDegrees:s,lineHeight:1,layer:o,load:u,mask:o,maxWidth:u,miterLimit:10,name:u,opacity:1,projection:0,r1:u,r2:u,radius:0,range:u,repeat:"repeat",respectAlign:o,rotate:0,rounded:o,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:d,shadowStroke:!1,shadowX:0,shadowY:0,sHeight:u,sides:0,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:d,strokeWidth:1,sWidth:u,sx:u,sy:u,text:"",translate:0,translateX:0,translateY:0,type:u,visible:s,width:u,x:0,y:0};Tn();Tn.extend=function(n){Tn.defaults=an(un,n.props);Tn();n[Z]&&(e.fn[n[Z]]=function r(e){var t=this,i,s,o,u=new xn(e);for(s=0;s<t[f];s+=1){i=t[s];o=Cn(i);if(o){e=zn(i,u,e,r);kn(i,o,u);n.fn[T](i,o,u)}}return t});return e.fn[n[Z]]};e.fn[E]=function(t){var n=this[0],r,i,s=[];if(n&&n[A]){r=Bn(n).layers;if(cn(t))for(i=0;i<r[f];i+=1)t[T](n,r[i])&&s.push(r[i]);else s=r}return s};e.fn[L]=function(n){var r=this[E](),i=e.type(n),s=Bn(this[0]),o,u;if(n&&n[l])o=n;else if(i==="number"){n<0&&(n=r[f]+n);o=r[n]}else if(i==="regexp"){for(u=0;u<r[f];u+=1)if(Nn(r[u][Z])&&r[u][Z][zt](n)){o=r[u];break}}else{s=Bn(this[0]);o=s[l].names[n]}return o};e.fn[C]=function(n){var r=e.type(n),i,s,o,u;if(r==="array")return n;if(r==="regexp"){u=Bn(this[0]);i=u[yt];for(s in i)if(s[zt](n)){o=i[s];break}}else{u=Bn(this[0]);o=u[l][yt][n]}return o};e.fn.getLayerIndex=function(t){var n=this[E](),r=this[L](t);return fn(r,n)};e.fn[on]=function(n,r){var i=this,s,o,u,a;for(o=0;o<i[f];o+=1){s=e(i[o]);u=Bn(i[o]);a=e(i[o])[L](n);if(a){qn(s,u,a,r);Rn(s,u,a,r);an(a,r);jn(s,u,a);In(s,u,a)}}return i};e.fn.setLayerGroup=function(n,r){var i=this,s,o,u,a;for(o=0;o<i[f];o+=1){s=e(i[o]);u=s[C](n);if(u)for(a=0;a<u[f];a+=1)s[on](u[a],r)}return i};e.fn.setLayers=function(n){var r=this,i,s,o,u;for(s=0;s<r[f];s+=1){i=e(r[s]);o=e(r[s])[E]();for(u=0;u<o[f];u+=1)i[on](o[u],n)}return r};e.fn.moveLayer=function(n,r){var i=this,s,o,u,a;for(o=0;o<i[f];o+=1){s=e(i[o]);u=s[E]();a=s[L](n);if(a){a[_]=fn(a,u);u[g](a[_],1);u[g](r,0,a);r<0&&(r=u[f]+r);a[_]=r}}return i};e.fn.removeLayer=function(n){var r=this,i,s,o,a,l;for(s=0;s<r[f];s+=1){i=e(r[s]);o=Bn(r[s]);a=i[E]();l=i[L](n);if(l){l[_]=fn(l,a);a[g](l[_],1);qn(i,o,l,{name:u});Rn(i,o,l,{group:u})}}return r};e.fn.removeLayerGroup=function(n){var r=this,i,s,o,c,h,p,d;if(n!==a)for(s=0;s<r[f];s+=1){i=e(r[s]);o=Bn(r[s]);c=i[E]();h=i[C](n);if(h){for(d=0;d<h[f];d+=1){p=h[d];p[_]=fn(p,c);c[g](p[_],1);qn(i,o,p,{name:u})}delete o[l][yt][h[Z]]}}return r};e.fn.removeLayers=function(){var n=this,r,i,s;for(i=0;i<n[f];i+=1){r=e(n[i]);s=Bn(n[i]);s.layers[f]=0;s[l].names={};s[l][yt]={}}return n};e.fn.drawLayer=function sr(t){var n=this,r,i,s,o;for(r=0;r<n[f];r+=1){s=e(n[r]);i=Cn(n[r]);o=s[L](t);sr(s,i,o)}return n};e.fn[j]=function(n){var r=this,i,a,c,p=n||{},d,v,m,y,b,E,S,N,C,L;p[_]||(p[_]=0);for(a=0;a<r[f];a+=1){i=e(r[a]);c=Cn(r[a]);if(c){b=Bn(r[a]);if(p[_]===0)for(y=0;y<b[h].masks;y+=1)i[$]();p.clear!==o&&i.clearCanvas();d=b.layers;for(m=p[_];m<d[f];m+=1){v=d[m];v[_]=m;p.resetFire&&(v[xt]=o);v[k]=!v.disableEvents;Un(i,c,v,m+1);if(v[Ut]){v[Ut]=o;v[xt]=s;v[Mt]=o;v[Y]&&v[Y][T](r[a],v);v[St]&&v._cursor&&i.css({cursor:v._cursor})}if(v[B]===e.fn[Q]&&v[w])break}if(p[_]===0)for(y=0;y<b[h].masks;y+=1)i[$]();v=b[lt][b[lt][f]-1]||[];E=b[q];S=E.type;v[S]||(S=Gn(S));L=v[S];N=b.drag;if(v[k]&&v[x]===s){if(v[J]||v[Y]||v[St])if(!v[Mt]&&!v[xt]){v[xt]=s;v[Mt]=s;v[J]&&v[J][T](r[a],v);if(v[St]){v._cursor=i.css(St);i.css({cursor:v[St]})}}if(L&&!v[xt]){v[xt]=s;E.type=u;L[T](r[a],v)}v[wt]&&!v.disableDrag&&(S===W||S===st)&&(N[l]=v)}if(N[l]){if(S===et||S===mt){if(N[l].dragstop&&N[kt]){N[l].dragstop[T](i,N[l]);N[kt]=o}b.drag={}}if(S===D||S===ct){if(!N[kt]){N[kt]=s;i.stopLayer(N[l]);N[l].dragstart&&N[l].dragstart[T](i,N[l]);if(N[l].bringToFront){d[g](N[l][_],1);N[l][_]=d.push(N[l])}C=b[l][yt][N[l][z]];if(N[l][z]&&N[l][V]&&C)for(m=0;m<C[f];m+=1)if(C[m]!==N[l]){C[m][Nt]=C[m].x;C[m][Ct]=C[m].y;C[m]._endX=N[l][tt];C[m]._endY=N[l][nt];if(C[m].bringToFront){C[m][_]=fn(C[m],d);d[g](C[m][_],1);d[g](-1,0,C[m]);C[m][_]=d[f]-2}}N[Nt]=N[l][Nt]=N[l].x;N[Ct]=N[l][Ct]=N[l].y;N._endX=N[l]._endX=N[l][tt];N._endY=N[l]._endY=N[l][nt]}N[l].x=N[l][tt]-(N._endX-N[Nt]);N[l].y=N[l][nt]-(N._endY-N[Ct]);N[l].drag&&N[l].drag[T](i,N[l]);if(N[l][z]&&N[l][V]){C=b[l][yt][N[l][z]];if(C)for(m=0;m<C[f];m+=1)if(C[m]!==N[l]){C[m].x=N[l][tt]-(C[m]._endX-C[m][Nt]);C[m].y=N[l][nt]-(C[m]._endY-C[m][Ct])}}}}b[lt]=[]}}return r};e.fn.addLayer=function(t){var n=this,r,i,o;o=new xn(t);for(r=0;r<n[f];r+=1){i=Cn(n[r]);if(i){o[l]=s;t=zn(n[r],o,t)}}return n};En=[p,c,"opacity",rt];Sn={};e.fn.animateLayer=function(){function m(e,t,n){return function(){Wn(n);(!t[it]||t[Ot]===n)&&e[j]();h[4]&&h[4][T](e[0],n);n[It]=o;t[it]=o;t[Ot]=u}}function y(e,t,n){return function(r,i){Wn(n);if(!n[It]&&!t[it]){n[It]=s;t[it]=s;t[Ot]=n}(!t[it]||t[Ot]===n)&&e[j]();h[5]&&h[5][T](e[0],r,i,n)}}var n=this,r,i,c,h=[].slice[T](arguments,0),p,d,v;ln(h[0])===_t&&!h[0][l]&&h.unshift(0);if(ln(h[2])===_t){h[g](2,0,h[2].duration||u);h[g](3,0,h[3].easing||u);h[g](4,0,h[4][rn]||u);h[g](5,0,h[5].step||u)}else{if(h[2]===a){h[g](2,0,u);h[g](3,0,u);h[g](4,0,u)}else if(cn(h[2])){h[g](2,0,u);h[g](3,0,u)}if(h[3]===a){h[3]=u;h[g](4,0,u)}else cn(h[3])&&h[g](3,0,u)}for(i=0;i<n[f];i+=1){r=e(n[i]);c=Cn(n[i]);if(c){p=Bn(n[i]);d=r[L](h[0]);if(d&&d[B]!==e.fn.draw){v=an({},h[1]);v=Vn(n[i],d,v);Xn(v,s);Xn(d);d[ht]=Sn;e(d).animate(v,{duration:h[2],easing:e.easing[h[3]]?h[3]:u,complete:m(r,p,d),step:y(r,p,d)})}}}return n};e.fn.animateLayerGroup=function(n){var r=this,i,s,o=[].slice[T](arguments,0),u,a;for(s=0;s<r[f];s+=1){i=e(r[s]);u=i[C](n);for(a=0;a<u[f];a+=1)i.animateLayer.apply(i,[u[a]].concat(o.slice(1)))}return r};e.fn.delayLayer=function(n,r){var i=this,s,o;r=r||0;for(s=0;s<i[f];s+=1){o=e(i[s])[L](n);e(o).delay(r)}return i};e.fn.delayLayerGroup=function(n,r){var i=this,s,o,u,a,l;r=r||0;for(o=0;o<i[f];o+=1){s=e(i[o]);u=s[C](n);if(u)for(l=0;l<u[f];l+=1){a=u[l];a&&e(a).delay(r)}}return i};e.fn.stopLayer=function(n,r){var i=this,s,o;for(s=0;s<i[f];s+=1){o=e(i[s])[L](n);o&&e(o).stop(r)}return i};e.fn.stopLayerGroup=function(n,r){var i=this,s,o,u,a,l;for(o=0;o<i[f];o+=1){s=e(i[o]);u=s[C](n);if(u)for(l=0;l<u[f];l+=1){a=u[l];a&&e(a).stop(r)}}return i};Kn([Bt,"backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor",y,"outlineColor",N,v]);gn={mousedown:st,mouseup:mt,mousemove:ct};yn={touchstart:W,touchend:et,touchmove:D};Yn("click");Yn("dblclick");Yn(W);Yn(et);Yn(D);Yn(J);Yn(Y);Yn(st);Yn(ct);Yn(mt);e[q].fix=function(t){var n,r,i;t=mn[T](e[q],t);r=t.originalEvent;if(r){i=r.changedTouches;if(t.pageX!==a&&t[$t]===a){n=e(t.target).offset();if(n){t[$t]=t.pageX-n.left;t.offsetY=t.pageY-n.top}}else if(i){n=e(r.target).offset();if(n){t[$t]=i[0].pageX-n.left;t.offsetY=i[0].pageY-n.top}}}return t};bn={arc:jt,bezier:sn,circle:jt,ellipse:Zt,"function":"draw",image:Q,line:"drawLine",polygon:en,quadratic:Wt,rectangle:"drawRect",text:"drawText",vector:tn};e.fn.draw=function or(t){var n=this,r,i,s,o;o=new xn(t);for(i=0;i<n[f];i+=1){r=e(n[i]);s=Cn(n[i]);if(s){t=zn(n[i],o,t);o[w]&&(o.fn?o.fn[T](n[i],s,o):o[B]!==or&&o[B][T](r,t))}}return n};e.fn.clearCanvas=function(t){var n=this,r,i,s=new xn(t);for(r=0;r<n[f];r+=1){i=Cn(n[r]);if(i)if(!s.x||!s.y||!s[p]||!s[c]){i.save();i.setTransform(1,0,0,1,0,0);i.clearRect(0,0,n[r][p],n[r][c]);i[H]()}else{Hn(i,s,s[p],s[c]);i.clearRect(s.x-s[p]/2,s.y-s[c]/2,s[p],s[c]);i[H]()}}return n};e.fn.saveCanvas=function(){var t=this,n,r,i;for(n=0;n<t[f];n+=1){r=Cn(t[n]);if(r){i=Bn(t[n]);r.save();i[O]=an({},i[h])}}return t};e.fn[$]=function(){var t=this,n,r,i;for(n=0;n<t[f];n+=1){r=Cn(t[n]);if(r){i=Bn(t[n]);r[H]();i[h]=an({},i[O])}}return t};e.fn.restoreCanvasOnRedraw=function(n){var r={layer:s,fn:function(){e(this)[$]()}};an(r,n);return this.draw(r)};e.fn.rotateCanvas=function ur(e){var t=this,n,r,i=new xn(e),s;for(n=0;n<t[f];n+=1){r=Cn(t[n]);if(r){s=Bn(t[n]);e=zn(t[n],i,e,ur);i[pt]&&r.save();_n(r,i,s[h])}}return t};e.fn.scaleCanvas=function ar(e){var t=this,n,r,i=new xn(e),s;for(n=0;n<t[f];n+=1){r=Cn(t[n]);if(r){s=Bn(t[n]);e=zn(t[n],i,e,ar);i[pt]&&r.save();Dn(r,i,s[h])}}return t};e.fn.translateCanvas=function fr(e){var t=this,n,r,i=new xn(e),s;for(n=0;n<t[f];n+=1){r=Cn(t[n]);if(r){s=Bn(t[n]);e=zn(t[n],i,e,fr);i[pt]&&r.save();Pn(r,i,s[h])}}return t};e.fn.drawRect=function lr(e){var t=this,n,r,i=new xn(e),u,a,l,h,d;for(n=0;n<t[f];n+=1){r=Cn(t[n]);if(r){e=zn(t[n],i,e,lr);if(i[w]){kn(t[n],r,i);Hn(r,i,i[p],i[c]);r[m]();u=i.x-i[p]/2;a=i.y-i[c]/2;d=i.cornerRadius;if(d){i[Et]=s;l=i.x+i[p]/2;h=i.y+i[c]/2;l-u-2*d<0&&(d=(l-u)/2);h-a-2*d<0&&(d=(h-a)/2);r[Jt](u+d,a);r[K](l-d,a);r.arc(l-d,a+d,d,3*pn/2,pn*2,o);r[K](l,h-d);r.arc(l-d,h-d,d,0,pn/2,o);r[K](u+d,h);r.arc(u+d,h-d,d,pn/2,pn,o);r[K](u,a+d);r.arc(u+d,a+d,d,pn,3*pn/2,o)}else r.rect(u,a,i[p],i[c]);i[k]&&Zn(t[n],r,i);Mn(t[n],r,i)}}}return t};e.fn[jt]=function cr(e){var t=this,n,r,i=new xn(e);e=e||{};i[l]&&!i[Tt]&&i.end===360&&(e.end=i.end=pn*2);for(n=0;n<t[f];n+=1){r=Cn(t[n]);if(r){e=zn(t[n],i,e,cr);if(i[w]){kn(t[n],r,i);Hn(r,i,i[Lt]*2);r[m]();r.arc(i.x,i.y,i[Lt],i[Ht]*i[G]-pn/2,i.end*i[G]-pn/2,i.ccw);i[k]&&Zn(t[n],r,i);Mn(t[n],r,i)}}}return t};e.fn[Zt]=function hr(e){var t=this,n,r,i=new xn(e),o=i[p]*4/3,u=i[c];i[Et]=s;for(n=0;n<t[f];n+=1){r=Cn(t[n]);if(r){e=zn(t[n],i,e,hr);if(i[w]){kn(t[n],r,i);Hn(r,i,i[p],i[c]);r[m]();r[Jt](i.x,i.y-u/2);r[dt](i.x-o/2,i.y-u/2,i.x-o/2,i.y+u/2,i.x,i.y+u/2);r[dt](i.x+o/2,i.y+u/2,i.x+o/2,i.y-u/2,i.x,i.y-u/2);i[k]&&Zn(t[n],r,i);Mn(t[n],r,i)}}}return t};e.fn[en]=function pr(e){var t=this,n,r,i=new xn(e),o=2*pn/i.sides,u=pn/i.sides,a=u+pn/2,l=i[Lt]*vn(o/2),c,h,p;i[Et]=s;i.projection&&(i[bt]=-i.projection);for(n=0;n<t[f];n+=1){r=Cn(t[n]);if(r){e=zn(t[n],i,e,pr);if(i[w]){kn(t[n],r,i);Hn(r,i,i[Lt]*2);r[m]();for(p=0;p<i.sides;p+=1){c=i.x+i[Lt]*vn(a);h=i.y+i[Lt]*dn(a);r[K](c,h);if(i[bt]){c=i.x+(l+ -l*i[bt])*vn(a+u);h=i.y+(l+ -l*i[bt])*dn(a+u);r[K](c,h)}a+=o}i[k]&&Zn(t[n],r,i);Mn(t[n],r,i)}}}return t};e.fn.drawLine=function dr(e){var t=this,n,r,i=new xn(e),o,u,l;for(n=0;n<t[f];n+=1){r=Cn(t[n]);if(r){e=zn(t[n],i,e,dr);if(i[w]){kn(t[n],r,i);Hn(r,i,0);o=1;r[m]();while(s){u=i["x"+o];l=i["y"+o];if(u===a||l===a)break;r[K](u+i.x,l+i.y);o+=1}i[k]&&Zn(t[n],r,i);Mn(t[n],r,i)}}}return t};e.fn[Wt]=e.fn.drawQuad=function vr(e){var t=this,n,r,i=new xn(e),o,u,l,c,h;for(n=0;n<t[f];n+=1){r=Cn(t[n]);if(r){e=zn(t[n],i,e,vr);if(i[w]){kn(t[n],r,i);Hn(r,i,0);o=2;r[m]();r[Jt](i.x1+i.x,i.y1+i.y);while(s){u=i["x"+o];l=i["y"+o];c=i["cx"+(o-1)];h=i["cy"+(o-1)];if(u===a||l===a||c===a||h===a)break;r.quadraticCurveTo(c+i.x,h+i.y,u+i.x,l+i.y);o+=1}i[k]&&Zn(t[n],r,i);Mn(t[n],r,i)}}}return t};e.fn[sn]=function mr(e){var t=this,n,r,i=new xn(e),o,u,l,c,h,p,d,v;for(n=0;n<t[f];n+=1){r=Cn(t[n]);if(r){e=zn(t[n],i,e,mr);if(i[w]){kn(t[n],r,i);Hn(r,i,0);o=2;u=1;r[m]();r[Jt](i.x1+i.x,i.y1+i.y);while(s){l=i["x"+o];c=i["y"+o];h=i["cx"+u];p=i["cy"+u];d=i["cx"+(u+1)];v=i["cy"+(u+1)];if(l===a||c===a||h===a||p===a||d===a||v===a)break;r[dt](h+i.x,p+i.y,d+i.x,v+i.y,l+i.x,c+i.y);o+=1;u+=2}i[k]&&Zn(t[n],r,i);Mn(t[n],r,i)}}}return t};e.fn[tn]=function gr(e){var t=this,n,i,o=new xn(e),u,l,c,h,p;for(n=0;n<t[f];n+=1){i=Cn(t[n]);if(i){e=zn(t[n],o,e,gr);if(o[w]){kn(t[n],i,o);Hn(i,o,0);u=1;i[m]();h=o.x;p=o.y;i[Jt](o.x,o.y);while(s){l=o["a"+u];c=o["l"+u];if(l===a||c===a)break;l=l*o[G]-pn/2;h+=c*r.cos(l);p+=c*r.sin(l);i[K](h,p);u+=1}o[k]&&Zn(t[n],i,o);Mn(t[n],i,o)}}}return t};e.fn.drawGraph=function yr(e){var t=this,n,r,i=new xn(e),s,o,a,l,h,d,v,m,g;for(n=0;n<t[f];n+=1){r=Cn(t[n]);if(r&&i.fn){e=zn(t[n],i,e,yr);if(i[w]){kn(t[n],r,i);s=i.graph;o=i.domain;a=i.range;l=t[n][p];h=t[n][c];o===u&&(o=[u,u]);o[0]===u&&(o[0]=0);o[1]===u&&(o[1]=l);a===u&&(a=[u,u]);a[0]===u&&(a[0]=0);a[1]===u&&(a[1]=h);er(n,r,i,o,a);if(s==="y")for(d=o[0]-i.x;d<=o[1]-i.x;d+=1){v=i.fn(d,i);if(v===u){tr(t[n],r,i);er(n,r,i,o,a)}else r[K](d+i.x,v+i.y)}else if(s==="x")for(v=a[0]-i.y;v<=a[1]-i.y;v+=1){d=i.fn(v,i);if(d===u){tr(t[n],r,i);er(n,r,i,o,a)}else r[K](d+i.x,v+i.y)}else if(s==="r")for(g=0;g<2*pn;g+=pn/180){m=i.fn(g,i);d=m*vn(g);v=m*dn(g);if(m===u){tr(t[n],r,i);er(r,i,o,a)}else r[K](d+i.x,v+i.y)}tr(t[n],r,i)}}}return t};e.fn.drawText=function br(t){var n=this,r,i,s,o=new xn(t),a,l,h,g;for(i=0;i<n[f];i+=1){r=e(n[i]);s=Cn(n[i]);if(s){t=zn(n[i],o,t,br);if(o[w]){kn(n[i],s,o);s.textBaseline=o.baseline;s.textAlign=o.align;nr(s,o);!i&&o[At]!==u?a=ir(s,o):i||(a=String(o.text).split("\n"));i||rr(n[i],s,o,a);Hn(s,o,o[p],o[c]);if(!i){h=o.x;o.align==="left"&&!o.respectAlign?h-=o[p]/2:o.align==="right"&&!o.respectAlign&&(h+=o[p]/2)}for(l=0;l<a[f];l+=1){s[v]=o[v];g=o.y+l*o[c]/a[f]-(a[f]-1)*o[c]/a[f]/2;s.fillText(a[l],h,g);o[y]!==d&&(s[v]=d);s.strokeText(a[l],h,g)}if(o[k]){s[m]();s.rect(o.x-o[p]/2,o.y-o[c]/2,o[p],o[c]);s[H]();Zn(n[i],s,o);s[X]();An(s,Bn(n[i]),o)}else s[H]()}}}wn=o;return n};e.fn[R]=function wr(e){var t=this,n,r,i;e===a||ln(e)===_t&&!e[l]?r=new xn(e):r=t[L](e);n=Cn(t[0]);if(n){nr(n,r);i=ir(n,r);wr(t[0],n,r,i)}return r};e.fn[Q]=function Er(t){function S(e,n){if(e===0){E=g[p]/g[c];v[p]===u&&v[U]===u&&(v[p]=v[U]=g[p]);v[c]===u&&v[M]===u&&(v[c]=v[M]=g[c]);if(t&&v[l]){t[p]=v[p];t[c]=v[c]}kn(r[e],n,v);if(v[U]!==u&&v[M]!==u&&v.sx!==u&&v.sy!==u){v[p]===u&&(v[p]=v[U]);v[c]===u&&(v[c]=v[M]);if(!v.cropFromCenter){v.sx+=v[U]/2;v.sy+=v[M]/2}v.sx+v[U]/2>g[p]&&(v.sx=g[p]-v[U]/2);v.sx-v[U]/2<0&&(v.sx=v[U]/2);v.sy-v[M]/2<0&&(v.sy=v[M]/2);v.sy+v[M]/2>g[c]&&(v.sy=g[c]-v[M]/2);Hn(n,v,v[p],v[c]);n[Q](g,v.sx-v[U]/2,v.sy-v[M]/2,v[U],v[M],v.x-v[p]/2,v.y-v[c]/2,v[p],v[c])}else{Hn(n,v,v[p],v[c]);n[Q](g,v.x-v[p]/2,v.y-v[c]/2,v[p],v[c])}}n[m]();n.rect(v.x-v[p]/2,v.y-v[c]/2,v[p],v[c]);v[k]&&Zn(r[e],n,v);On(n,v);d=Bn(r[e]);n[X]();n.stroke();Ln(n,d,v);An(n,d,v)}function x(n,r,i){return function(){S(r,i);v[Gt]&&v[Gt][T](n,t);v[l]&&v._next&&e(n)[j]({clear:o,resetFire:s,index:v._next})}}var r=this,i,a,h,d,v=new xn(t),g,y,b,E;b=v.source;y=b[A];if(b.src||y)g=b;else if(b)if(wn.source===b)g=wn._source;else{g=new n;g.src=b;wn.source=b;wn._source=g}for(a=0;a<r[f];a+=1){i=r[a];h=Cn(r[a]);if(h){t=zn(r[a],v,t,Er);if(v[w]&&g)if(g[rn]||y)x(i,a,h)();else{e(g).bind(Gt,x(i,a,h));g.src=g.src}}}return r};e.fn[nn]=e.fn.pattern=function(r){function d(){f=s[nn](a,o.repeat);o[Gt]&&o[Gt][T](i[0],f)}var i=this,s,o=new xn(r),a,f,l,h;s=Cn(i[0]);if(s){h=o.source;if(cn(h)){a=e(Vt)[0];a[p]=o[p];a[c]=o[c];l=Cn(a);h[T](a,l);d()}else{l=h[A];if(h.src||l)a=h;else{a=new n;a.src=h}if(a[rn]||l)d();else{e(a).bind(Gt,d);a.src=a.src}}}else f=u;return f};e.fn.createGradient=e.fn.gradient=function(t){var n=this,r,i=new xn(t),s,o=[],l,c,h,p,d,v,m;r=Cn(n[0]);if(r){i.x1=i.x1||0;i.y1=i.y1||0;i.x2=i.x2||0;i.y2=i.y2||0;i.r1!==u||i.r2!==u?s=r.createRadialGradient(i.x1,i.y1,i.r1,i.x2,i.y2,i.r2):s=r.createLinearGradient(i.x1,i.y1,i.x2,i.y2);for(p=1;i["c"+p]!==a;p+=1)i["s"+p]!==a?o.push(i["s"+p]):o.push(u);l=o[f];o[0]===u&&(o[0]=0);o[l-1]===u&&(o[l-1]=1);for(p=0;p<l;p+=1){if(o[p]!==u){v=1;m=0;c=o[p];for(d=p+1;d<l;d+=1){if(o[d]!==u){h=o[d];break}v+=1}c>h&&(o[d]=o[p])}else if(o[p]===u){m+=1;o[p]=c+m*((h-c)/v)}s.addColorStop(o[p],i["c"+(p+1)])}}else s=u;return s};e.fn.setPixels=function Sr(e){var t=this,n,r,i,s=new xn(e),o={},a,l,h,d;for(r=0;r<t[f];r+=1){n=t[r];i=Cn(n);if(i){e=zn(n,s,e,Sr);Hn(i,s,s[p],s[c]);if(s[p]===u||s[c]===u){s[p]=n[p];s[c]=n[c];s.x=s[p]/2;s.y=s[c]/2}if(s[p]!==0&&s[c]!==0){a=i.getImageData(s.x-s[p]/2,s.y-s[c]/2,s[p],s[c]);l=a.data;d=l[f];o=[];if(s.each)for(h=0;h<d;h+=4){o.r=l[h];o.g=l[h+1];o.b=l[h+2];o.a=l[h+3];s.each[T](n,o);l[h]=o.r;l[h+1]=o.g;l[h+2]=o.b;l[h+3]=o.a}i.putImageData(a,s.x-s[p]/2,s.y-s[c]/2);i[H]()}}}return t};e.fn.getCanvasImage=function(t,n){var r=this[0];n===a&&(n=1);return r&&r.toDataURL?r.toDataURL("image/"+t,n):u};e.fn.detectPixelRatio=function(n){var r=this,i,o,u,a,l,h,d,v,m,g;for(u=0;u<r[f];u+=1){o=r[u];i=e(r[u]);a=Cn(o);g=Bn(r[u]);if(!g.scaled){l=window.devicePixelRatio||1;h=a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1;d=l/h;if(d!==1){v=o[p];m=o[c];o[p]=v*d;o[c]=m*d;o[ht][p]=v+"px";o[ht][c]=m+"px";a.scale(d,d)}g[Pt]=d;g.scaled=s;n&&n[T](o,d)}}return r};e.support.canvas=e(Vt)[0][A]!==a;Tn.defaults=un;Tn._detectEvents=Zn;Tn[X]=Mn;e[ot]=Tn})(jQuery,document,Image,Math,parseFloat,!0,!1,null);