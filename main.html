<!doctype html>
<html>
<head>
	<meta charset="UTF-8">
	<script type="text/javascript" src="core/jquery.js"></script>
	<script type="text/javascript" src="core/jcanvas.js"></script>
	<script type="text/javascript" src="core/scrollsync.js"></script>
	<script type="text/javascript" src="core/dragscrollable.js"></script>
	<script type="text/javascript" src="core/jquery.mousewheel.js"></script>
	
	<script type="text/javascript" src="core/jquery.transit.js"></script>
	<script type="text/javascript" src="core/jquery.custom-scrollbar.js"></script>
	
	<script type="text/javascript" src="core/jquery-ui-1.10.3.custom.min.js"></script>
		
	<script type="text/javascript" src="core/ractive.js"></script>	
		
	<!-- <script type="text/javascript" src="core/handlebars.js"></script> -->
	<script type="text/javascript" src="core/tooltipsy.js"></script>
	
	<script type="text/javascript" src="core/hex_map.js"></script>
	<script type="text/javascript" src="core/core.js"></script>
	<script type="text/javascript" src="core/hex.js"></script>	
	
	<link rel="stylesheet" type="text/css" href="css/jquery.custom-scrollbar.css" />
	<link rel="stylesheet" type="text/css" href="css/void.less.php" />
	
	<style>
		
	</style>
</head>

<body>
	<div id="void_app">
		
	</div>
	
	<script id="primary_template" type="text/ractive">
	<div id="main_loading">
		<img src="images/voidwars.png">
		<p><img src="images/ajax-loader-big.gif"> Loading...</p>
		<p id="loading_status"></p>
	</div>
	<div id="main_header">
		<h1 title="Super Special Space Hex Adventure"><img src="images/voidwars_small.png"></h1>
		<nav class="primary">
			<ul class="primary_menu">
		    <!--<li class="active menu_item"><a href="#">Galactic Map</a></li>
		    <li class="menu_item"><a href="#research">Research</a></li>
		    <li class="menu_item"><a href="#empire">Empire Overview</a></li>
		    <li class="menu_item"><button type="button" onclick="map_zoom(1);"> + </button>
				<button type="button" onclick="map_zoom(0);"> - </button></li>
				-->
				<li class="menu_item"><button id="tactical_button" type="button" onclick="change_view('tactical');">Tactical</button></li>
				<li class="menu_item"><button id="research_button" type="button" onclick="change_view('research');">Research</button></li>
				<li class="menu_item"><button id="diplomacy_button" type="button" onclick="change_view('diplomacy');">Diplomacy</button></li>
				<li class="menu_item"><button id="end_turn_button" type="button" onclick="end_turn();"> End Turn</button></li>
				<li class="menu_item"><button id="reset_game_button" type="button" onclick="reset_game();"> Reset</button></li>
		  </ul>
		  
    </nav>
    <div id="player_resources">
    	{{>player_resources_template}}
    </div>
    <div id="player_status">
    	<p>
    	{{#player.done}}
    	Turn Complete. 
    	{{/player.done}}
    	{{#waiting_for_players.length > 1}}
    	<span decorator="tooltip" data-decorator="waiting_tooltip">Waiting for {{waiting_for_players.length+1}} players</span>    
    	{{/waiting_for_players.length > 1}}
    	{{#waiting_for_players.length == 1}}
    	Waiting for <span style="color : {{waiting_for_players.0.color.border}};">{{waiting_for_players.0.name}}</span>
    	{{/waiting_for_players.length == 1}}
    	{{^waiting_for_players}}
    	Waiting for you
    	{{/waiting_for_players}}
    	</p>
    	<div class="tooltip" id="waiting_tooltip">
    	<p>Waiting for:</p>
    	<ul>
    	{{#waiting_for_players}}
    		<li>{{name}}</li>
    	{{/waiting_for_players}}
    	</ul>
    	</span>
    </div>
	</div>
	
	<div id="view_container">
		<div id="tactical_view" class="view">
			<div id="galactic_map_container" style="position : absolute;">
				<div id="galactic_map_dragger"></div>
				<canvas id="galactic_map_hexes" width="2000px" height="2000px"></canvas>
				<canvas id="galactic_map_objects" width="2000px" height="2000px"></canvas>
				<canvas id="galactic_map_buffer_hexes" width="2000px" height="2000px" style="display : none;"></canvas>				
				<canvas id="galactic_map_buffer_objects" width="2000px" height="2000px" style="display : none;"></canvas>				
				<canvas id="galactic_map_overlay"></canvas>			
			</div>	
			{{#hex_selected}}
			<div id="galactic_map_panel">				
				<div id="galactic_map_panel_content">
					{{>galactic_map_panel_sector_template}}
				</div>			
			</div>
			{{/hex_selected}}
			
			<div id="galactic_map_minimap">
				<div id="galactic_map_mini_container">
				<canvas id="galactic_map_mini" width="200px" height="200px"></canvas>
				<canvas class="dragger" id="galactic_map_mini_overlay" width="200px" height="200px"></canvas>
				</div>
			</div>
			
			{{#fleet_selected}}
			<div id="galactic_map_panel_fleet">
				{{>galactic_map_panel_fleet_template}}
			</div>
			
			{{#fleet_selected.sub}}
				<div id="galactic_map_panel_fleet_sub" decorator="lock:galactic_map_panel_fleet">				
				{{>construction_template}}
				</div>
			{{/fleet_selected.sub}}
			
			{{/fleet_selected}}						
			
			
			
			{{#player.logs}}
			<div id="galactic_map_event_list">
				{{> event_log_template}}
			</div>
			{{/player.logs}}						
			
			<div id="tooltip_box" style="border : solid white 3px; background-color : red; position : absolute; display : none; z-index : 50000">
				tooltip content here!
			</div>
			
		</div>
		
		{{#tech_tree}}
		<div id="research_view" style="display : none;" class="view">
			<!-- canvas used to drew line between techs 
			<canvas id="tech_tree_back" width="800px" height="800px"></canvas>-->
			<div id="tech_tree_items">
				{{>tech_tree_template}}
			</div>
		</div>
		{{/tech_tree}}
		
		<div id="diplomacy_view" style="display : none;" class="view">
			{{>diplomacy_template}}
		</div>			
	
	</div>
	
	{{#global_error}}
	<div id="error_display">
		{{global_error}}
	</div>
	{{/global_error}}
	
	<div id="tooltip_display">
	
	</div>
	
	<div id="big_dialog">
	
	</div>
	
	<div id="tooltip_block">
		{{#ship_class_cache:key}}
		<div class="tooltip" id="ship-class-tooltip-{{id}}">
			{{> ship_class_template}}
		</div>
		{{/ship_class_cache}}
		{{#structure_class_cache:key}}
		<div class="tooltip" id="structure-class-tooltip-{{id}}">
			{{> structure_class_template}}
		</div>
		{{/structure_class_cache}}
		{{#upgrade_class_cache:key}}
		<div class="tooltip" id="upgrade-class-tooltip-{{id}}">
			{{> upgrade_class_template}}
		</div>
		{{/upgrade_class_cache}}
		{{#sector_class_cache:key}}
		<div class="tooltip" id="sector-class-tooltip-{{id}}">
			{{> sector_class_template}}
		</div>
		{{/sector_class_cache}}
	</div>
	
	{{#fleet_management}}
	<div class="dialog">
		<div class="dialog_body">
			<div class="dialog_header">
				<h2> Fleet Management
				<button class="close_window" onclick="void_view.set('fleet_management', null)">Return to Map</button></h2>				
			</div>
			<div id="dialog_content" class="dialog_content">
				<!-- show all ships in the current fleet and ships in the shipyard -->
				<div data-fleet="{{fleet_selected.id}}" ondrop="fleet_management_drop(event)" ondragover="event.preventDefault();" class="fleet_management_fleet">
				<h4>Fleet</h4>
				<ul>
					{{#fleet_selected.ships:key}}
					<li id="{{id}}" data-fleet="{{fleet_selected.id}}" data-index="{{key}}" ondragstart="fleet_management_drag(event)" draggable="true" class="fleet_management_ship fleet_management_ship_allowed system_view_selector" decorator="tooltip" data-decorator="ship-class-tooltip-{{class_id}}">
						<img src="images/ship.png">
						<h4>{{ship_class_cache[class_id].name}}</h4>						
					</li>										
					{{/fleet_selected.ships}}
				</ul>
				</div>
				
				{{#hex_selected.space_dock}}
				<div data-fleet="{{hex_selected.space_dock.fleet.id}}" ondrop="fleet_management_drop(event)" ondragover="event.preventDefault();" class="fleet_management_fleet">
				<h4>Space Dock</h4>
				<ul>
					{{#hex_selected.space_dock.fleet.ships:key}}
					<li id="{{id}}" data-fleet="{{hex_selected.space_dock.fleet.id}}" data-index="{{key}}" ondragstart="fleet_management_drag(event)" draggable="true" class="fleet_management_ship fleet_management_ship_allowed system_view_selector" decorator="tooltip" data-decorator="ship-class-tooltip-{{class_id}}">
						<img src="images/ship.png">
						<h4>{{ship_class_cache[class_id].name}}</h4>						
					</li>					
					{{/hex_selected.space_dock.fleet.ships}}
				</ul>
				</div>
				{{/hex_selected.space_dock}}
				
				<!-- show all ships an adjacent sectors -->				
				{{#fleet_management_hexes}}
				{{#your_fleets.0}}
				<div data-fleet="{{your_fleets.0.id}}" ondrop="fleet_management_drop(event)" ondragover="event.preventDefault();" class="fleet_management_fleet">
				<h4>Adjacent Hex ({{x}}, {{z}})</h4>
				<ul>
					{{#your_fleets.0.ships:key}}
					<li id="{{id}}" data-fleet="{{your_fleets.0.id}}"  data-index="{{key}}" ondragstart="fleet_management_drag(event)" draggable="{{#from_fleet}}true{{/from_fleet}}" class="{{#from_fleet}}fleet_management_ship_allowed{{/from_fleet}} fleet_management_ship system_view_selector" decorator="tooltip" data-decorator="ship-class-tooltip-{{class_id}}">
						<img src="images/ship.png">
						<h4>{{ship_class_cache[class_id].name}}</h4>						
					</li>							
					{{/your_fleets.0.ships}}
				</ul>
				</div>
				{{/your_fleets.0}}
				{{/fleet_management_hexes}}
				<!-- drag and drop ships between fleets respecting limits --> 
			</div>
		</div>
	</div>	
	{{/fleet_management}}
	
	{{#system_view}}	
	{{#system_view.system}}
	<div id="system_view_window" class="dialog">
		<div class="dialog_body">
			<div class="dialog_header">
				<h2> <span id="dialog_title">{{#name}}{{name}}{{/name}}{{^name}}System{{/name}} at ({{x}}, {{z}})</span> 
				<button class="close_window" onclick="void_view.set('system_view', {})">Return to Map</button></h2>				
			</div>
			<div id="dialog_content" class="dialog_content">
				{{# mode == "colonise"}}
				{{>system_view_colonise_template}}
				{{/ mode == "colonise"}}
				{{# mode == "full"}}
				{{>system_view_template}}
				{{/ mode == "full"}}
			</div>
		</div>
	</div>	
	{{/system_view.system}}
	{{/system_view}}
	
	</script>

	
	<script id="diplomacy_template" type="text/ractive">
		<div id="diplomacy_player_list_container">
			<ul class="diplomacy_player_list">
				{{#players:key}}
				
				<li class="diplomacy_player_item" onclick="show_diplomacy_detail({{id}})" style="background-color : {{color.background}}; border-color : {{color.border}}">
				<h3>{{name}}</h3>
				{{#met}}
				<p>{{sector_count}}</p>
				{{/met}}
				</li>				
				{{/players}}
				
			</ul>
		</div>
		<div id="diplomacy_detail_view">
			{{#diplomacy.selected_player}}
				{{>diplomacy_detail_template}}
			{{/diplomacy.selected_player}}
		</div>
	</script>
	
	<script id="diplomacy_detail_template" type="text/ractive">
		<div class="diplomacy_detail_view" style="border-color : {{color.border}}">
			<h2>{{name}}</h2>
			<h3>Trade</h3>
			<h3>Status</h3>
			<p>{{sector_count}}</p>
		</div>
	</script>
	
	<script id="event_log_template" type="text/ractive">
		<div>
			<ul>
			{{#player.logs:key}}
				<li class="event_log_item">
				{{# category == "ship"}}
				<img src="images/icons/production.png" alt="ship" title="ship">
				{{/category}}
				{{# category == "generic"}}
				<img src="images/icons/happy.png" alt="Generic" title="Generic">
				{{/category}}
				{{text}}
				</li>
			{{/player.logs}}
			</ul>
		</div>
	</script>
	
	
	
	<script id="ship_class_tooltip_templates" type="text/ractive">
		
	</script>
	
	<script id="tech_tree_template" type="text/ractive">
		<div>		
		{{#tiers:key}}
			<div class="tech_tier tech_tier_{{key}}">
			{{#.}}
				<div class="tech_tree_item {{#.player_has}}researched_tech{{/.player_has}} {{#.player_available}}available_tech{{/.player_available}} tier_{{tier}} tech_{{id}} {{#.player_current}}current_tech{{/.player_current}}" onclick="select_tech({{id}})">
					<h4>{{name}}</h4>
					
					{{#.player_available}}
						<p>This tech is available to research.</p>
						<p>{{.player_available.progress}} research points needed</p>
					{{/.player_available}}
					{{^.player_available}}
						{{#.player_has}}
						This tech has been researched
						{{/.player_has}}
						{{^.player_has}}
						<p>{{cost}} research points needed</p>
						{{/.player_has}}		
					{{/.player_available}}			
					
					<div class="tech_rewards">										
					{{#ship_classes}}
					<span decorator="tooltip" data-decorator="ship-class-tooltip-{{id}}"><img width="16" height="16" src="images/ship.png"> {{name}}</span>
					{{/ship_classes}}
					{{#structure_classes}}
					<span decorator="tooltip" data-decorator="structure-class-tooltip-{{id}}"><img width="16" height="16" src="images/structure.png"> {{name}}</span>
					{{/structure_classes}}
					{{#power_classes}}
					<span ><img width="16" height="16" src="images/power.png"> {{name}}</span>
					{{/power_classes}}
					{{#upgrade_classes}}
					<span decorator="tooltip" data-decorator="upgrade-class-tooltip-{{id}}"><img width="16" height="16" src="images/power.png"> {{name}}</span>
					{{/upgrade_classes}}					
					</div>
				</div>
			{{/.}}
			</div>
		{{/tiers}}
		
		</div>	
	</script>
	
	
	<script id="galactic_map_panel_fleet_template" type="text/ractive">		
		<h3 class="map_panel_header">{{id}} ({{x}}, {{z}})</h3>
		<h4>Actions</h4>
		<p>
		<button type="button" onclick="start_fleet_order_mode('{{id}}')">Move Fleet</button>
		<button type="button" onclick="add_fleet_colonise_order_dialog()">Colonise</button>
		<button type="button" onclick="add_fleet_construct_order_dialog()">Construct</button>
		<button type="button" onclick="start_fleet_management()">Fleet Management</button>
		<button type="button" onclick="cancel_fleet_orders()">Cancel All Orders</button>
		</p>
		<h4>Ships</h4>
		{{#ships.length > 0}}			
			<ul>
			{{#ships}}
			<li decorator="tooltip" data-decorator="ship-class-tooltip-{{class.id}}">
			{{class.name}} (Shields: {{shields}} Hull: {{hull}})</li>				
			</li>
			{{/ships}}
			</ul>
		{{/ships.length > 0}}
		{{^ships}}
			None
		{{/ships}}
	</script>
	
	<script id="galactic_map_panel_sector_template" type="text/ractive">
		<h3 class="map_panel_header">Sector {{x}}, {{z}}</h3>
		<div class="map_panel_content">
			{{#system}}
			<button class="wide_button" type="button" onclick="show_system_view({{x}}, {{z}} );"><img width="16" height="16" src="images/default.png"> View System</button>		
			{{/system}}
			
			<table class="data_block">
				{{#type_id}}
					<tr>
					<th>Type</th>
					<td>{{sector_class_cache[type_id].name}}</td>
					</tr>
				{{/type_id}}
				
				{{#upgrade_id}}
					<tr>
					<th>Upgrade</th>
					<td decorator="tooltip" data-decorator="upgrade-class-tooltip-{{upgrade_id}}">{{upgrade_class_cache[upgrade_id].name}}</td>
					</tr>
				{{/upgrade_id}}
				
				<tr> 
					<th>Owner</th>
					{{#friendly}}
					<td class="friendly" style="color : {{owner_object.color.border}}">You</td>
					{{/friendly}}
					{{^friendly}}
						{{#enemy}}
						<td class="enemy" style="color : {{owner_object.color.border}}">{{owner_object.name}}</td>
						{{/enemy}}
						{{^enemy}}
						<td>None</td>
						{{/enemy}}
					{{/friendly}}
				</tr>
				
				{{#system.name}}
					<tr>
					<th>Name</th>
					<td>{{system.name}}</td>
					</tr>
				{{/system.name}}
				
				{{#system.influence_level}}
				<tr>
					<th>Influence</th>
					<td class="tooltip-template" data-tooltip-id="system-influence-tooltip">
					Level {{system.influence_level}} ({{system.influence_growth_turns}} turns) 					
					</td>
				</tr>
				{{/system.influence_level}}
				
				{{# system.planets.length > 0}}
				<tr>
					<th>Planets</th>
					<td>
					<ul class="small_planet_list">
					{{#system.planets}}
	
						{{# planet_class_cache[class_id] }}
						<li class="{{#terraformed}} terraformed{{/terraformed}}">
							<img decorator="tooltip" data-decorator="planet-class-tooltip-{{id}}-{{class.id}}" width="30" height="30" src="{{#terraformed}}{{image_populated}}{{/terraformed}}{{^terraformed}}{{image}}{{/terraformed}}" alt="{{name}}">
							<div class="tooltip" id="planet-class-tooltip-{{id}}-{{class.id}}">						
								<h4>{{name}}</h4>	
								{{> planet_template}}
							</div>
						</li>
						{{/planet_class_cache}}
					{{/system.planets}}
					</ul>
					</td>
				</tr>
				{{/ end of filter }}
				
				{{#system.owner}}
				<tr>
					<th>Population</th>
					<td>{{system.population}} </td>
				</tr>
				<tr>
					<th>Output</th>
					<td>
					<img src="images/icons/credits.png"> {{void.per_turn_value(system.credits_per_turn)}} 
					<img src="images/icons/research.png"> {{void.per_turn_value(system.research_per_turn)}}
					</td>
				</tr>
				
				{{#friendly}}
				<tr>
					<th>Queue	
					</th>
					<td>
					
					{{#system.build_queue.items.length > 0}}
					<ul>
					{{# system.build_queue.items.0 }}

					<li>				
					{{#type == "ship"}}
						<span decorator="tooltip" data-decorator="ship-class-tooltip-{{target_id}}">
						{{ship_class_cache[target_id].name}}
						{{#purchased}}
						1 turn
						{{/purchased}}
						
						{{^purchased}}
						{{#production_per_turn}} {{void.turns(progress, production_per_turn)}} {{/production_per_turn}} 						
						{{/purchased}}
						</span>
					{{/type == "ship"}}					
					{{#type == "structure"}}
						<span decorator="tooltip" data-decorator="structure-class-tooltip-{{target_id}}">
						{{structure_class_cache[target_id].name}}
						{{#purchased}}
						1 turn
						{{/purchased}}
						
						{{^purchased}}
						{{#production_per_turn}} {{void.turns(progress, production_per_turn)}} {{/production_per_turn}} 						
						{{/purchased}}
						</span>		
					{{/type == "structure"}}								
					</li>
					{{/ system.build_queue.items.0 }}
					
					<li>{{ system.build_queue.items.length }} total items</li>
			
					</ul>
					{{/system.build_queue.items.length > 0}}
					
					{{^system.build_queue.items}}
					<p>Empty</p>
					{{/system.build_queue.items}}
					</td>
				</tr>
				
				
				{{#space_dock}}
					<tr>
					<th>Space dock (Max 3)</th>
					<td>
					{{#space_dock.fleet}}
					<ul>
					{{#space_dock.fleet.ships}}
					<li>{{ship_class_cache[class_id].name}}</li>
					{{/space_dock.fleet.ships}}
					</ul>
					{{/space_dock.fleet}}
					
					{{^space_dock.fleet}}
					<p>No Ships</p>
					{{/space_dock.fleet}}
					</td>
					</tr>
				{{/space_dock}}
				
				{{/friendly}}
				
				{{/system.owner}}
				
			</table>
						
		</div>
	</script>
	

	
	<script id="planet_template" type="text/ractive">
		<img src="{{#terraformed}}{{image_populated}}{{/terraformed}}{{^terraformed}}{{image}}{{/terraformed}}" alt="{{name}}" title="{{name}}" oncontextmenu="context_menu(event, {})">
			<ul class="planet_class_output">
				<li class="food"><img src="images/icons/food.png" alt="Food" title="Food"> +{{output.food}}</li>
				<li class="production"><img src="images/icons/production.png" alt="Production" title="Production"> +{{output.production}}</li>
				<li class="research"><img src="images/icons/research.png" alt="Research" title="Research"> +{{output.research}}</li>
				<li class="credits"><img src="images/icons/credits.png" alt="Credits" title="Credits"> +{{output.credits}}</li>
			</ul>
			{{#terraformed}}Terraformed{{/terraformed}}{{^terraformed}}Uninhabited{{/terraformed}}
	</script>
	
	<script id="ship_class_template" type="text/ractive">			
			<h4>{{name}}</h4>
			<ul class="ship_class">				
				<li>Weapons: {{weapon_count}}x{{weapon_damage}} ({{weapon_type}})</li>				
				<li>Special: {{special}}</li>
				<li>Movement Capacity: {{movement_capacity}}</li>
				<li>Hull: {{hull}}</li>
				<li>Shields: {{shields}}</li>
				<li>Production cost: {{work_required}}</li>
			</ul>
	</script>
	
	<script id="structure_class_template" type="text/ractive">			
			<h4>{{name}}</h4>
			{{#empire_unique}}
			<p>One per empire.</p>
			{{/empire_unique}}
			{{#world_unique}}
			<p>One per galaxy.</p>
			{{/world_unique}}
			<ul class="structure_class">				
				{{#modifiers}}
					<ul>
					{{#modifiers.production}}
						<li class="production modifier"><img src="images/icons/production.png" alt="Production" title="Production"> {{void.per_turn_value(modifiers.production)}}</li>
					{{/modifiers.production}}
					{{#modifiers.food}}
						<li class="food modifier"><img src="images/icons/food.png" alt="Food" title="Food"> {{void.per_turn_value(modifiers.food)}}</li>					
					{{/modifiers.food}}
					{{#modifiers.research}}
						<li class="research modifier"><img src="images/icons/research.png" alt="Research" title="Research"> {{void.per_turn_value(modifiers.research)}}</li>
					{{/modifiers.research}}
					{{#modifiers.credits}}
						<li class="credits modifier"><img src="images/icons/credits.png" alt="Credits" title="Credits"> {{void.per_turn_value(modifiers.credits)}}</li>
					{{/modifiers.credits}}
					{{#modifiers.morale}}
						<li class="morale modifier"><img src="images/icons/happy.png" alt="Morale" title="Morale"> {{void.per_turn_value(modifiers.morale)}}</li>
					{{/modifiers.morale}}
					{{#modifiers.influence}}
						<li class="influence modifier"><img src="images/icons/influence.png" alt="Influence" title="Influence"> {{void.per_turn_value(modifiers.influence)}}</li>
					{{/modifiers.influence}}
					</ul>					
				{{/modifiers}}
			</ul>
	</script>
	
	<script id="upgrade_class_template" type="text/ractive">			
			<h4>{{name}}</h4>
			<ul class="structure_class">				
				{{#modifiers}}
					<ul>
					{{#modifiers.production}}
						<li class="production modifier"><img src="images/icons/production.png" alt="Production" title="Production"> {{void.per_turn_value(modifiers.production)}}</li>
					{{/modifiers.production}}
					{{#modifiers.food}}
						<li class="food modifier"><img src="images/icons/food.png" alt="Food" title="Food"> {{void.per_turn_value(modifiers.food)}}</li>					
					{{/modifiers.food}}
					{{#modifiers.research}}
						<li class="research modifier"><img src="images/icons/research.png" alt="Research" title="Research"> {{void.per_turn_value(modifiers.research)}}</li>
					{{/modifiers.research}}
					{{#modifiers.credits}}
						<li class="credits modifier"><img src="images/icons/credits.png" alt="Credits" title="Credits"> {{void.per_turn_value(modifiers.credits)}}</li>
					{{/modifiers.credits}}
					{{#modifiers.morale}}
						<li class="morale modifier"><img src="images/icons/happy.png" alt="Morale" title="Morale"> {{void.per_turn_value(modifiers.morale)}}</li>
					{{/modifiers.morale}}
					{{#modifiers.influence}}
						<li class="influence modifier"><img src="images/icons/influence.png" alt="Influence" title="Influence"> {{void.per_turn_value(modifiers.influence)}}</li>
					{{/modifiers.influence}}
					</ul>					
				{{/modifiers}}
			</ul>
	</script>
	
	
	<script id="sector_class_template" type="text/ractive">			
			<h4>{{name}}</h4>
			<ul class="sector_class">				
				{{#modifiers}}
					<ul>
					{{#modifiers.production}}
						<li class="production modifier"><img src="images/icons/production.png" alt="Production" title="Production"> {{void.per_turn_value(modifiers.production)}}</li>
					{{/modifiers.production}}
					{{#modifiers.food}}
						<li class="food modifier"><img src="images/icons/food.png" alt="Food" title="Food"> {{void.per_turn_value(modifiers.food)}}</li>					
					{{/modifiers.food}}
					{{#modifiers.research}}
						<li class="research modifier"><img src="images/icons/research.png" alt="Research" title="Research"> {{void.per_turn_value(modifiers.research)}}</li>
					{{/modifiers.research}}
					{{#modifiers.credits}}
						<li class="credits modifier"><img src="images/icons/credits.png" alt="Credits" title="Credits"> {{void.per_turn_value(modifiers.credits)}}</li>
					{{/modifiers.credits}}
					{{#modifiers.morale}}
						<li class="morale modifier"><img src="images/icons/happy.png" alt="Morale" title="Morale"> {{void.per_turn_value(modifiers.morale)}}</li>
					{{/modifiers.morale}}
					{{#modifiers.influence}}
						<li class="influence modifier"><img src="images/icons/influence.png" alt="Influence" title="Influence"> {{void.per_turn_value(modifiers.influence)}}</li>
					{{/modifiers.influence}}
					</ul>					
				{{/modifiers}}
			</ul>
	</script>
	
	
	<script id="system_view_colonise_template" type="text/ractive">
		<div id="system_view">
		{{#system.planets.length > 0}}		
		<ul class="system_view_planet_list">
		{{#system.planets}}
			<li onclick="void_view.set('system_view', {}); add_fleet_colonise_order('{{id}}')" class="system_view_planet class{{class.id}} selectable">
				{{# planet_class_cache[class_id]}}
				{{> planet_template}}
				{{/planet_class_cache[class_id]}}
			</li>
		{{/system.planets}}
		</ul>
		{{/system.planets.length > 0}}
		</div>
	</script>
	
	<script id="construction_template" type="text/ractive">
		<div>
			<ul>
			{{#player.available_upgrade_classes:key}}
				<li decorator="tooltip" data-decorator="upgrade-class-tooltip-{{id}}"><button onclick="add_fleet_construct_order({{id}})">{{upgrade_class_cache[id].name}}</button></li>
			{{/player.available_upgrade_classes}}
			</ul>
		</div>
	</script>
	
	<script id="system_view_template" type="text/ractive">
		<div id="system_view">
				
		{{# planets.length > 0}}		
		<ul class="system_view_planet_list">
		{{#planets}}
			<li class="system_view_planet class{{class_id}}">
				{{# planet_class_cache[class_id]}}
				{{> planet_template}}
				{{/ planet_class_cache}}
			</li>
		{{/planets}}
		</ul>
		{{/planets}}
		
		{{#yours}}
			<ul class="planet_output">			
			<li><img src="images/icons/food.png" alt="Food" title="Food"> {{food_per_turn}}</li>
			<li class="planet_output_bar">
			
			</li>
			<li><img src="images/icons/production.png" alt="Production" title="Production"> {{production_per_turn}}</li>
			<li><img src="images/icons/research.png" alt="Research" title="Research"> {{research_per_turn}}</li>
			<li><img src="images/icons/credits.png" alt="Credits" title="Credits"> {{credits_per_turn}}</li>
			<li><img src="images/icons/influence.png" alt="Influence" title="Influence"> {{influence_per_turn}}</li>
			</ul>
			
			<div class="system_view_list">
			<h4>Available Ship Classes</h4>
			<ul class="selector_list" decorator="custom_scroll">
			{{#player.available_ship_classes:key}}
				<li class="system_view_selector" decorator="tooltip" data-decorator="ship-class-tooltip-{{id}}">
					<img src="images/ship.png">
					<h4>{{name}}</h4>
					<p>
					{{#production_per_turn}} {{void.turns(work_required, production_per_turn)}} {{/production_per_turn}}
					<button type="button" onclick="build_ship('{{id}}');">Build</button>
					</p>
				</li>
				
			{{/player.available_ship_classes}}
			</ul>
			</div>
			
			<div class="system_view_list">
			<h4>Available Structure Classes</h4>
			<ul class="selector_list" decorator="custom_scroll">
			{{#available_structure_classes}}				
				
				<li class="system_view_selector" decorator="tooltip" data-decorator="structure-class-tooltip-{{id}}">
					<img src="images/structure.png">
					<h4>{{name}}</h4>
					<p>
					{{#../../production_per_turn}} {{void.turns(structure_class_cache[id].work_required, ../../production_per_turn)}} {{/../../production_per_turn}}					
					<button type="button" onclick="build_structure('{{id}}');">Build</button>
					</p>

				</li>
				
			{{/available_structure_classes}}
			</ul>
			</div>
			
			<div class="system_view_list">
			<h4>System Queue</h4>
			
			{{#.}}
			<div class="selector_list custom_scroll" decorator="custom_scroll">
			<ul class="selector_list" >
			{{# build_queue.items.length > 0}}
				{{#build_queue.items}}
						
				{{# type == "ship"}}
				<li class="system_view_selector" decorator="tooltip" data-decorator="ship-class-tooltip-{{target_id}}">		
				<img src="images/ship.png">
				<h4>{{ship_class_cache[target_id].name}}</h4>
				<p>
				{{#purchased}}
				1 turn
				{{/purchased}}
				
				{{^purchased}}
				{{#production_per_turn}} {{void.turns(progress, production_per_turn)}} {{/production_per_turn}} 
				<button type="button" onclick="buy_queue_item('{{id}}')">Rush <img src="images/icons/credits.png">{{ship_class_cache[target_id].rush_cost}}</button>
				{{/purchased}}
				</p>
				</li>
				{{/ type}}
				{{# type == "structure"}}
				<li class="system_view_selector" decorator="tooltip" data-decorator="structure-class-tooltip-{{target_id}}">		
				<img src="images/structure.png">
				<h4>{{structure_class_cache[target_id].name}}</h4>
				<p>
				{{#production_per_turn}} {{void.turns(progress, production_per_turn)}} {{/production_per_turn}}
				<button type="button" onclick="buy_queue_item('{{id}}')">Rush <img src="images/icons/credits.png">{{structure_class_cache[target_id].rush_cost}}</button>
				</p>
				</li>
				{{/ type}}				
				
				{{/build_queue.items}}			
			{{/build_queue.items}}
			{{^build_queue.items}}
			<li>Empty</li>
			{{/build_queue.items}}
			</ul>
			</div>
			{{/.}}
			</div>
			
			<div class="system_view_list">
			<h4>Structures</h4>
			{{# structures.length > 0}}
			<ul class="selector_list" >
			{{#structures}}
				<li class="system_view_selector" decorator="tooltip" data-decorator="structure-class-tooltip-{{class_id}}">
				<img src="images/structure.png">
				<h4>{{name}}</h4>
				
				</li>
				{{/structures}}
			</ul>			
			{{/structures}}
			
			{{^structures}}
			<p>None</p>
			{{/structures}}
			</div>
			
		{{/yours}}
		
		
		
		
		</div>
	</script>
	
	<script id="map_context_menu_default" type="text/x-handlebars-template">
		
		<h3>{{x}}, {{z}}</h3>
		{{#if your_fleets}}
		<h3>Fleets</h3>
		<ul class="context_menu">
			{{#each your_fleets}}<li class="context_menu_item" onclick="show_map_panel_fleet('{{id}}')">{{id}}</li>{{/each}}
		</ul>
		{{/if}}
	</script>
	
	<script id="map_context_menu_fleet_move" type="text/x-handlebars-template">
		<ul class="context_menu">
			<li class="context_menu_item" onclick="start_fleet_order()">End Fleet Move</li>
		</ul>
	</script>
	
	<div id="galactic_map_context_menu" class="context_menu_container">
		
	</div>
	
	
	<script id="system_planet_context_menu" type="text/x-handlebars-template">
		<ul class="context_menu">
			<li class="context_menu_item" onclick="terraform_planet()">Terraform</li>
		</ul>
	</script>
	
	
	
	<script id="player_resources_template" type="text/ractive">
		<span decorator="tooltip" data-decorator="player-credits-tooltip">
		<img src="images/icons/credits.png"> {{player.credits_pool}} ({{void.per_turn_value(player.credits_per_turn)}})    
		</span>

		<span decorator="tooltip" data-decorator="player-morale-tooltip">
    <img src="images/icons/happy.png"> 
		<span class="{{# player.morale > 0 }}positive{{/ end of filter }}{{# player.morale < 0 }}negative{{/ end of filter }}"> 
    {{player.morale}} 
   	</span>
   	</span>
   	
   	<div class="tooltip" id="player-morale-tooltip">
			{{# player.morale < 0}}
			<p>Negative morale lowers your systems growth to 10% of normal</p>
			{{/ player.morale < 0}}
			{{#player.sources.morale}}
			<ul>				
				<li>Population: {{void.per_turn_value(population)}}</li>
				<li>Systems: {{void.per_turn_value(system)}}</li>
				<li>Structures: {{void.per_turn_value(structures)}}</li>
			</ul>
			{{/player.sources.morale}}			
		</div>
		
		<div class="tooltip" id="player-credits-tooltip">
			
			{{#player.sources.credits}}
			<ul>				
				<li>Fleet Upkeep: {{void.per_turn_value(ship)}}</li>
				<li>Systems: {{void.per_turn_value(system)}}</li>
			</ul>
			{{/player.sources.credits}}			
		</div>
   	
   	<span decorator="tooltip" data-decorator="player-research-tooltip">
   	<img src="images/icons/research.png"> {{player.current_tech.class.name}} ({{ Math.ceil(player.current_tech.progress / player.research_per_turn) }} turns) 
   	</span>
   	
   	<div class="tooltip" id="player-research-tooltip">
			{{void.per_turn_value(player.research_per_turn)}} ({{player.current_tech.progress}} / {{player.current_tech.class.cost}})
		</div>
   	
	</script>
	
	
	<script id="progress_bar_template" type="text/x-handlebars-template">
		<div class="progress_bar {{this.class}}_bar">
			<div class="progress_bar_inner" style="width : {{this.percent}}%"></div>
		</div>
	</script>
	
	
	<script>

	</script>
	
	
</body>
</html>
