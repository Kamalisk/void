<!doctype html>
<html>
<head>
	<meta charset="UTF-8">
	<script type="text/javascript" src="core/jquery.js"></script>
	<script type="text/javascript" src="core/jcanvas.js"></script>
	<script type="text/javascript" src="core/scrollsync.js"></script>
	<script type="text/javascript" src="core/dragscrollable.js"></script>
	<script type="text/javascript" src="core/jquery.mousewheel.js"></script>
	
	<script type="text/javascript" src="core/jquery.transit.js"></script>
	<script type="text/javascript" src="core/jquery.custom-scrollbar.js"></script>
	<script type="text/javascript" src="core/perfect-scrollbar.js"></script>
	
	<script type="text/javascript" src="core/jquery-ui-1.10.3.custom.min.js"></script>
		
	<script type="text/javascript" src="core/ractive.js"></script>	
		
	<script type="text/javascript" src="core/hex_map.js"></script>
	<script type="text/javascript" src="core/core.js"></script>
	<script type="text/javascript" src="core/hex.js"></script>	
	
	<link rel="stylesheet" type="text/css" href="css/perfect-scrollbar.css" />
	<link rel="stylesheet" type="text/css" href="css/void.less.php" />
	
	<style>
		
	</style>
</head>

<body>
	<div id="void_app">
		
	</div>
	
	<script id="primary_template" type="text/ractive">
	<div id="login">
		<div class="login">
			<h1>Voidwars Login</h1>
			<form onsubmit="return false;">
				<input id="username" type="text" name="username" placeholder="username">
				<input id="password" type="password" name="password" placeholder="password">
				<button type="submit" onclick="login()">login</button>
			</form>
		</div>
	</div>
	<div id="portal">
		<div>
			<header class="portal_header">
				<h1>Voidwars Portal</h1>
				
				<button type="button" onclick="logout()">Logout</button>
				<button type="button" onclick="create_game()">Create Game</button>
			</header>
			
			{{#portal.your_games.length > 0}}
			<h2>Your Games</h2>
			<table class="portal_list">
				<tr>
					<th>Name</th>
					<th>Created</th>
					<th>Actions</th>
				</tr>
			{{#portal.your_games}}
				<tr>
				<td>{{name}}</td>
				<td></td>
				<td>{{#state == "lobby" && joinable && !joined}}<button type="button" onclick="join_lobby({{id}})">Join Game</button>{{/}}
				{{#state == "lobby" && joined}}<button type="button" onclick="join_lobby({{id}})">View Game</button>{{/}}
				{{#state == "started" && joined}}<button type="button" onclick="play_game({{id}})">Play Game</button>{{/}}
				</td>
				</tr>
			{{/portal.your_games}}
			</table>
			{{/portal.your_games > 0}}
			
			<h2>Available Games</h2>
			<table class="portal_list">
				<tr>
					<th>Name</th>
					<th>Created</th>
					<th>Actions</th>
				</tr>
			{{#portal.games}}
				<tr>
				<td>{{name}}</td>
				<td></td>
				<td>{{#state == "lobby" && joinable && !joined}}<button type="button" onclick="join_lobby({{id}})">Join Game</button>{{/}}
				{{#state == "lobby" && joined}}<button type="button" onclick="join_lobby({{id}})">View Game</button>{{/}}
				{{#state == "started" && joined}}<button type="button" onclick="play_game({{id}})">Play Game</button>{{/}}
				</td>
				</tr>
			{{/portal.games}}
			</table>
		</div>
	</div>
	<div id="main_loading">
		<img src="images/voidwars.png">
		<p><img src="images/ajax-loader-big.gif"> Loading...</p>
		<p id="loading_status"></p>
	</div>
	{{#game_state == "lobby"}}
		<div id="lobby">
			<div id="lobby_header">
			<h1>Game {{game_id}}</h1>
			{{#player}}						
			<button type="button" onclick="start_game()">START THE GAME</button>
			{{/player}}			
			<button type="button" onclick="reset_lobby()">RESET THE LOBBY</button>
			</div>
			
			<div id="lobby_content">									
			{{#!player}}
			<h2>Join Game</h2>
			<p>Join the game from here!<p>
			<button type="button" onclick="join_game()">JOIN THE GAME</button>
			
			{{/player}}
			
			{{#player}}
			<h2>Color Select</h2>
			<p>Select a color for your empire</p>
			<ul class="color_selector" >
			{{#player_colors:i}}
				<li class="" onclick="select_color({{i}})" style="background-color : {{background}}; border : solid 2px {{border}}">{{#.selected}} X {{/.selected}}</li>
			{{/player_colors}}
			</ul>
			
			<h2>Race Select</h2>
			
			<p>Select a race, empire and leader click ready. When all are ready the game will start</p>
			
			<div class="player_race_selector">
				<div class="race_selector lobby_selector">
				<h3>Races</h3>
				<ul>
				{{#races:i}}
				<li class="{{#selected}}selected{{/selected}}" onclick="select_race('{{i}}');">
				<h4>{{name}}</h4>			
				</li>
				{{/races}}
				</ul>
				</div>
				
				<div class="empire_selector lobby_selector">
				<h3>Empires</h3>
				<ul>
				{{#selected_race.empires:i}} 
				<li class="{{#selected}}selected{{/selected}}" onclick="select_empire('{{i}}')"> 
				<h4>{{name}}</h4>
				<p>{{#powers:i}} {{description}} {{/powers}}</p>
				</li>
				{{/selected_race.empires}}
				</ul>
				</div>
				
				<div class="leader_selector lobby_selector">
				<h3>Leaders</h3>
				<ul>
				{{#selected_race.leaders:i}} 
				<li class="{{#selected}}selected{{/selected}}" onclick="select_leader('{{i}}')"> 
				<h4>{{name}}</h4>
				<p>{{#powers:i}} {{description}} {{/powers}}</p>
				</li> {{/selected_race.leaders}}
				</ul>
				</div>
				
				<div class="selector_summary">
					{{#selected_race}}
						<h2>{{name}}</h2>
						{{#powers:i}}
						<p>{{description}}</p>
						{{/powers}}
						
						{{#selected_empire}}
							<h2>{{name}}</h2>
							{{#powers:i}}
							<p>{{description}}</p>
							{{/powers}}
						{{/selected_empire}}
						{{#selected_leader}}
							<h2>{{name}}</h2>
							{{#powers:i}}
							<p>{{description}}</p>
							{{/powers}}
						{{/selected_leader}}
						
						{{#selected_leader && selected_empire}}
						<p><button type="button" onclick="send_race()">Select this Race, Empire and Leader</button></p>
						{{/selected_leader && selected_empire}}
					{{/selected_race}}
				</div>
				
			</div>
						
			{{/player}}
			</div>
			
			
			<div id="player_list">
			<h2>Player List</h2>
			<ul>
				{{#players:i}}<li>{{name}}</li>{{/players}}
			<ul>
			
			</div>
			
		</div>
	{{/game_state == "waiting"}}
	
	{{#hex_map}}
	<div id="main_header">
		<h1 title="Super Special Space Hex Adventure"><img src="images/voidwars_small.png"></h1>
		<nav class="primary">
			<ul class="primary_menu">
		    <!--<li class="active menu_item"><a href="#">Galactic Map</a></li>
		    <li class="menu_item"><a href="#research">Research</a></li>
		    <li class="menu_item"><a href="#empire">Empire Overview</a></li>
		    <li class="menu_item"><button type="button" onclick="map_zoom(1);"> + </button>
				<button type="button" onclick="map_zoom(0);"> - </button></li>
				-->
				<li class="menu_item"><button id="tactical_button" type="button" onclick="change_view('tactical');">Tactical</button></li>
				<li class="menu_item"><button id="research_button" type="button" onclick="change_view('research');">Research</button></li>
				<li class="menu_item"><button id="diplomacy_button" type="button" onclick="change_view('diplomacy');">Diplomacy</button></li>
				<li class="menu_item"><button id="end_turn_button" type="button" onclick="end_turn();"> End Turn</button></li>
				<li class="menu_item"><button id="reset_game_button" type="button" onclick="reset_game();"> Reset</button></li>
		  </ul>
		  
    </nav>
    <div id="player_resources">
    	{{>player_resources_template}}
    </div>
    <div id="player_status">
    	<p>
    	{{#player.done}}
    	Turn Complete. 
    	{{/player.done}}
    	{{#waiting_for_players.length > 1}}
    	<span decorator="tooltip" data-decorator="waiting_tooltip">Waiting for {{waiting_for_players.length+1}} players</span>    
    	{{/waiting_for_players.length > 1}}
    	{{#waiting_for_players.length == 1}}
    	Waiting for <span style="color : {{waiting_for_players.0.color.border}};">{{waiting_for_players.0.name}}</span>
    	{{/waiting_for_players.length == 1}}
    	{{^waiting_for_players}}
    	Waiting for you
    	{{/waiting_for_players}}
    	</p>
    	<div class="tooltip" id="waiting_tooltip">
    	<p>Waiting for:</p>
    	<ul>
    	{{#waiting_for_players}}
    		<li>{{name}}</li>
    	{{/waiting_for_players}}
    	</ul>
    	</span>
    </div>
	</div>
	
	<div id="view_container">
		<div id="tactical_view" class="primary_view">
			<div id="galactic_map_container" style="position : absolute;">
				<div id="galactic_map_dragger"></div>
				<canvas id="galactic_map_hexes" width="2000px" height="2000px"></canvas>
				<canvas id="galactic_map_objects" width="2000px" height="2000px"></canvas>
				<canvas id="galactic_map_buffer_hexes" width="2000px" height="2000px" style="display : none;"></canvas>				
				<canvas id="galactic_map_buffer_objects" width="2000px" height="2000px" style="display : none;"></canvas>				
				<canvas id="galactic_map_overlay"></canvas>			
			</div>	
			{{#hex_selected}}
			<div id="galactic_map_panel">				
				<div id="galactic_map_panel_content">
					{{>galactic_map_panel_sector_template}}
				</div>			
			</div>
			{{/hex_selected}}
			
			<div id="galactic_map_minimap">
				<div id="galactic_map_mini_container">
				<canvas id="galactic_map_mini" width="200px" height="200px"></canvas>
				<canvas class="dragger" id="galactic_map_mini_overlay" width="200px" height="200px"></canvas>
				</div>
			</div>
			
			{{#fleet_selected}}
			<div id="galactic_map_panel_fleet">
				{{>galactic_map_panel_fleet_template}}
			</div>
			
			{{#fleet_selected.sub}}
				<div id="galactic_map_panel_fleet_sub" decorator="lock:galactic_map_panel_fleet">				
				{{>construction_template}}
				</div>
			{{/fleet_selected.sub}}
			
			{{#combat_comparison}}
				<div id="combat_comparison">
				{{>combat_comparison_template}}
				</div>
			{{/combat_comparison}}
			
			{{/fleet_selected}}						
			
			{{#enemy_fleet_selected}}
			<div id="galactic_map_panel_enemy_fleet">
				{{>galactic_map_panel_enemy_fleet_template}}
			</div>
			{{/enemy_fleet_selected}}			
			
			
			{{#player.logs}}
			<div id="galactic_map_event_list">
				{{> event_log_template}}
			</div>
			{{/player.logs}}						
			
			<div id="tooltip_box" style="border : solid white 3px; background-color : red; position : absolute; display : none; z-index : 50000">
				tooltip content here!
			</div>
			
		</div>
		
		{{#tech_tree}}
		<div id="research_view" style="display : none;" class="view" decorator="custom_scroll">
			<!-- canvas used to drew line between techs 
			<canvas id="tech_tree_back" width="800px" height="800px"></canvas>-->
			<div>
			<div id="tech_tree_items" >
				{{>tech_tree_template}}
			</div>
			</div>
		</div>
		{{/tech_tree}}
		
		<div id="diplomacy_view" style="display : none;" class="view">
			{{>diplomacy_template}}
		</div>			
	
	</div>
	{{/hex_map}}
	
	{{#global_error}}
	<div id="error_display">
		{{global_error}}
	</div>
	{{/global_error}}
	
	<div id="tooltip_display">
	
	</div>
	
	<div id="big_dialog">
	
	</div>
	
	<div id="tooltip_block">
		{{#ship_class_cache:key}}
		<div class="tooltip" id="ship-class-tooltip-{{id}}">
			{{> ship_class_template}}
		</div>
		{{/ship_class_cache}}
		{{#structure_class_cache:key}}
		<div class="tooltip" id="structure-class-tooltip-{{id}}">
			{{> structure_class_template}}
		</div>
		{{/structure_class_cache}}
		{{#upgrade_class_cache:key}}
		<div class="tooltip" id="upgrade-class-tooltip-{{id}}">
			{{> upgrade_class_template}}
		</div>
		{{/upgrade_class_cache}}
		{{#power_class_cache:key}}
		<div class="tooltip" id="power-class-tooltip-{{id}}">
			{{> power_class_template}}
		</div>
		{{/power_class_cache}}
		{{#sector_class_cache:key}}
		<div class="tooltip" id="sector-class-tooltip-{{id}}">
			{{> sector_class_template}}
		</div>
		{{/sector_class_cache}}
	</div>
	
	{{#fleet_management}}
	<div class="dialog">
		<div class="dialog_body">
			<div class="dialog_header">
				<h2> Fleet Management
				<button class="close_window" onclick="end_fleet_management()">Return to Map</button></h2>				
			</div>
			<div id="dialog_content" class="dialog_content">
				<!-- show all ships in the current fleet and ships in the shipyard -->
				<div data-fleet="{{fleet_selected.id}}" ondrop="fleet_management_drop(event)" ondragover="event.preventDefault();" class="fleet_management_fleet">
				<h4>Fleet at {{fleet_selected.x}},{{fleet_selected.z}}</h4>
				<ul>
					{{#fleet_selected.ships:key}}
					<li id="{{id}}" data-fleet="{{fleet_selected.id}}" data-index="{{key}}" ondragstart="fleet_management_drag(event)" draggable="true" class="fleet_management_ship fleet_management_ship_allowed system_view_selector" decorator="tooltip" data-decorator="ship-class-tooltip-{{class_id}}">
						<img draggable="false" data-fleet="{{fleet_selected.id}}" src="images/ship.png">
						<h4 draggable="false" data-fleet="{{fleet_selected.id}}">{{ship_class_cache[class_id].name}}</h4>
					</li>										
					{{/fleet_selected.ships}}
				</ul>
				</div>
				
				{{#hex_selected.space_dock}}
				<div data-fleet="{{hex_selected.space_dock.fleet.id}}" ondrop="fleet_management_drop(event)" ondragover="event.preventDefault();" class="fleet_management_fleet">
				<h4>Space Dock</h4>
				<ul>
					{{#hex_selected.space_dock.fleet.ships:key}}
					<li id="{{id}}" data-fleet="{{hex_selected.space_dock.fleet.id}}" data-index="{{key}}" ondragstart="fleet_management_drag(event)" draggable="true" class="fleet_management_ship fleet_management_ship_allowed system_view_selector" decorator="tooltip" data-decorator="ship-class-tooltip-{{class_id}}">
						<img draggable="false" data-fleet="{{hex_selected.space_dock.fleet.id}}" src="images/ship.png">
						<h4 draggable="false" data-fleet="{{hex_selected.space_dock.fleet.id}}">{{ship_class_cache[class_id].name}}</h4>						
					</li>					
					{{/hex_selected.space_dock.fleet.ships}}
				</ul>
				</div>
				{{/hex_selected.space_dock}}
				
				<!-- show all ships an adjacent sectors -->				
				{{#fleet_management_hexes}}
				{{#your_fleets.0}}
				<div data-fleet="{{your_fleets.0.id}}" ondrop="fleet_management_drop(event)" ondragover="event.preventDefault();" class="fleet_management_fleet">
				<h4>Adjacent Hex ({{x}}, {{z}})</h4>
				<ul>
					{{#your_fleets.0.ships:key}}
					<li id="{{id}}" data-fleet="{{your_fleets.0.id}}"  data-index="{{key}}" ondragstart="fleet_management_drag(event)" draggable="{{#from_fleet}}true{{/from_fleet}}" class="{{#from_fleet}}fleet_management_ship_allowed{{/from_fleet}} fleet_management_ship system_view_selector" decorator="tooltip" data-decorator="ship-class-tooltip-{{class_id}}">
						<img draggable="false" data-fleet="{{your_fleets.0.id}}" src="images/ship.png">
						<h4 draggable="false" data-fleet="{{your_fleets.0.id}}">{{ship_class_cache[class_id].name}}</h4>						
					</li>							
					{{/your_fleets.0.ships}}
				</ul>
				</div>
				{{/your_fleets.0}}
				{{/fleet_management_hexes}}
				<!-- drag and drop ships between fleets respecting limits --> 
			</div>
		</div>
	</div>	
	{{/fleet_management}}
	
	{{#system_view}}	
	{{#system_view.system}}
	<div id="system_view_window" class="dialog" >
		
			{{# mode == "full"}}
			{{>system_view_template}}
			{{/ mode == "full"}}
			{{# mode == "colonise"}}
			<div class="dialog_body">
			<div class="dialog_header">
				<h2> <span id="dialog_title">{{#name}}{{name}}{{/name}}{{^name}}System{{/name}} at ({{hex_selected.x}}, {{hex_selected.z}})</span> 
				<button class="close_window" onclick="void_view.set('system_view', {})">Return to Map</button></h2>				
			</div>
			<div id="dialog_content" class="dialog_content">				
				{{>system_view_colonise_template}}				
			</div>
			</div>
			{{/ mode == "colonise"}}
		
	</div>	
	{{/system_view.system}}
	{{/system_view}}
	
	</script>

	
	<script id="diplomacy_template" type="text/ractive">
		<div id="diplomacy_player_list_container">
			<ul class="diplomacy_player_list">
				{{#players:key}}
				{{#player.id != key && is_player}}
				<li class="diplomacy_player_item" onclick="show_diplomacy_detail({{id}})" style="background-color : {{color.background}}; border-color : {{color.border}}">
				<h3>{{name}}</h3>
				{{#met}}
				<p>Status: {{#war}}War{{/war}}{{^war}}Peace{{/war}}</p>
				<p>Sectors controlled:{{sector_count}}</p>
				{{/met}}
				{{^met}}
				<p>You have not yet met this empire</p>
				{{/met}}
				</li>
				{{/player.id != key}}
				{{/players}}
				
			</ul>
		</div>
		<div id="diplomacy_detail_view">
			{{#diplomacy.selected_player}}
				{{>diplomacy_detail_template}}
			{{/diplomacy.selected_player}}
		</div>
	</script>
	
	<script id="diplomacy_detail_template" type="text/ractive">
		<div class="diplomacy_detail_view" style="border-color : {{color.border}}">
			<h2>{{name}}</h2>
			{{#met}}			
			<p>{{#war}}You are currently at <em>War</em>{{/war}}{{^war}}You are currently at <em>Peace{{/war}}</p>
			{{^war}}		
			
			{{#declaring_war}}
			<button onclick="undeclare_war({{id}})">Cancel War Declaration</button>
			{{/declaring_war}}
			
			{{#!declaring_war}}
			<button onclick="declare_war({{id}})">Declare War</button>
			{{/declaring_war}}
			
			{{/war}}
			
			{{#war}}
			<button onclick="declare_peace({{id}})">Request Peace Treaty</button>
			{{/war}}
			
			<p>Sectors controlled:{{sector_count}}</p>
			<h3>Trade</h3>
			{{/met}}
			{{^met}}
			<p>You have not yet met this empire</p>
			{{/met}}
		</div>
	</script>
	
	<script id="event_log_template" type="text/ractive">
		<div>
			<ul>
			{{#player.logs:key}}
				<li class="event_log_item">
				{{# category == "ship"}}
				<img src="images/icons/production.png" alt="ship" title="ship">
				{{/category}}
				{{# category == "diplomacy"}}
				<img src="images/icons/influence.png" alt="Diplomacy" title="Diplomacy">
				{{/category}}
				{{# category == "research"}}
				<img src="images/icons/research.png" alt="Research" title="Research">
				{{/category}}
				{{# category == "combat"}}
				<img src="images/icons/influence.png" alt="Generic" title="Generic">
				{{/category}}
				{{# category == "movement"}}
				<img src="images/icons/influence.png" alt="Generic" title="Generic">
				{{/category}}
				{{# category == "generic"}}
				<img src="images/icons/happy.png" alt="Generic" title="Generic">
				{{/category}}
				{{text}}
				</li>
			{{/player.logs}}
			</ul>
		</div>
	</script>
	
	
	
	<script id="ship_class_tooltip_templates" type="text/ractive">
		
	</script>
	
	<script id="tech_tree_template" type="text/ractive">
		<div class="tech_tree_view">
			<ul class="tech_traits">
			<li>Research Credits</li>
			<li><img width="16" height="16" src="images/icons/traits/military.png"> {{player.tech_traits.military}} military</li>
			<li><img width="16" height="16" src="images/icons/traits/commerce.png"> {{player.tech_traits.commerce}} commerce</li>
			<li><img width="16" height="16" src="images/icons/traits/culture.png"> {{player.tech_traits.culture}} culture</li>
			<li><img width="16" height="16" src="images/icons/traits/agriculture.png"> {{player.tech_traits.agriculture}} agriculture</li>
			<li><img width="16" height="16" src="images/icons/traits/industry.png"> {{player.tech_traits.industry}} industry</li>
			<li><img width="16" height="16" src="images/icons/traits/science.png"> {{player.tech_traits.science}} science</li>
			</ul>			
			<div class="tech_tiers">
		{{#tiers:key}}
			<div class="tech_tier tech_tier_{{key}}">
			
			{{#.}}
				<div class="tech_tree_item {{#.player_has}}researched_tech{{/.player_has}} {{#.player_available}}available_tech{{/.player_available}} tier_{{tier}} tech_{{id}} {{#.player_current}}current_tech{{/.player_current}}" onclick="select_tech({{id}})">					
					<h4>
					
					{{name}}
					{{^name}}Tech {{id}}{{/name}}
					</h4>
					<!--
					{{#.player_available}}
						<p>This tech is available to research.</p>
						<p>{{.player_available.progress}} research points needed</p>
					{{/.player_available}}
					{{^.player_available}}
						{{#.player_has}}
						This tech has been researched
						{{/.player_has}}
						{{^.player_has}}
						<p>Requires {{tier_requirement}} from Tier {{key-1}}</p>
						<p>{{cost}} research points needed</p>
						{{/.player_has}}		
					{{/.player_available}}			
					-->
					
					{{#traits_required}}
					
					<div class="traits_required">
					Requires: {{#traits_required:type}}
					{{# type == "agriculture"}}
						{{# . > 1}}{{.}}{{/.}} <img title="agriculture" width="16" height="16" src="images/icons/traits/agriculture.png">
					{{/type}}
					{{# type == "military"}}
						{{# . > 1}}{{.}}{{/.}} <img title="military" width="16" height="16" src="images/icons/traits/military.png">
					{{/.}}
					{{# type == "culture"}}
						{{# . > 1}}{{.}}{{/.}} <img title="culture" width="16" height="16" src="images/icons/traits/culture.png">
					{{/type}}
					{{# type == "commerce"}}
						{{# . > 1}}{{.}}{{/.}} <img title="commerce" width="16" height="16" src="images/icons/traits/commerce.png">
					{{/type}}
					{{# type == "industry"}}
						{{# . > 1}}{{.}}{{/.}} <img title="industry" width="16" height="16" src="images/icons/traits/industry.png">
					{{/type}}
					{{# type == "science"}}
						{{# . > 1}}{{.}}{{/.}} <img title="science" width="16" height="16" src="images/icons/traits/science.png">
					{{/type}}
					{{/traits_required}}	
					
					</div>
					{{/traits_required}}
					
					<div class="tech_rewards">										
					{{#ship_classes}}
					<span decorator="tooltip" data-decorator="ship-class-tooltip-{{id}}"><img width="16" height="16" src="images/ship.png"> {{name}}</span>
					{{/ship_classes}}
					{{#structure_classes}}
					<span decorator="tooltip" data-decorator="structure-class-tooltip-{{id}}"><img width="16" height="16" src="images/structure.png"> {{name}}</span>
					{{/structure_classes}}
					{{#power_classes}}
					<span decorator="tooltip" data-decorator="power-class-tooltip-{{id}}"><img width="16" height="16" src="images/power.png"> {{name}}</span>
					{{/power_classes}}
					{{#upgrade_classes}}
					<span decorator="tooltip" data-decorator="upgrade-class-tooltip-{{id}}"><img width="16" height="16" src="images/power.png"> {{name}}</span>
					{{/upgrade_classes}}
					{{#.traits_given:type}}
					{{# type == "agriculture"}}
						<span><img width="16" height="16" src="images/icons/traits/agriculture.png"> 1 Agriculture credit</span>
					{{/type}}
					{{# type == "military"}}
						<span><img width="16" height="16" src="images/icons/traits/military.png"> 1 Military credit</span>
					{{/.}}
					{{# type == "culture"}}
						<span><img width="16" height="16" src="images/icons/traits/culture.png"> 1 Culture credit</span>
					{{/type}}
					{{# type == "commerce"}}
						<span><img width="16" height="16" src="images/icons/traits/commerce.png"> 1 Commerce credit</span>
					{{/type}}
					{{# type == "industry"}}
						<span><img width="16" height="16" src="images/icons/traits/industry.png"> 1 Industry credit</span>
					{{/type}}
					{{# type == "science"}}
						<span><img width="16" height="16" src="images/icons/traits/science.png"> 1 Science credit</span>
					{{/type}}
					{{/.traits_given}}
					</div>
					<div class="traits_given">
					
					</div>
					
				</div>
			{{/.}}
			</div>
		{{/tiers}}
		</div>
		</div>	
	</script>
	
	
	<script id="galactic_map_panel_fleet_template" type="text/ractive">		
		<h3 class="map_panel_header">Your Fleet ({{x}}, {{z}})</h3>
						
		<span style="display : inline-block; width : 90%;"><voidprogress class="fleet_health" text="{{health}}" subtext="{{max_health}}" value="{{health}}" max="{{max_health}}"></voidprogress></span>
		Attack: {{attack}}
		Defense: {{defense}}
		Damage : {{damage}}
		<h4>Ships</h4>
		{{#ships.length > 0}}			
			<table>
			{{#ships}}
			<tr>
			
			<td decorator="tooltip" data-decorator="ship-class-tooltip-{{ship_class_cache[class_id].id}}">
			<img width="16" height="16" src="images/ship.png"> {{ship_class_cache[class_id].name}} 
			</td>
			<td>	
			<span style="display : inline-block; width : 100px;"><voidprogress class="ship_health" text="{{health}}" subtext="{{max_health}}" value="{{health}}" max="{{max_health}}"></voidprogress></span>
			</td>
			</tr>
			
			{{/ships}}
			</table>
		{{/ships.length > 0}}
		{{^ships}}
			None
		{{/ships}}
		
		<h4>Actions</h4>
		<p class="fleet_actions">
		<button type="button" title="Move Fleet"  onclick="start_fleet_order_mode('{{id}}')"><img src="images/move.png"> Move</button>
		<button type="button" title="Fleet Managements" onclick="start_fleet_management()"><img src="images/logistics.png"> Manage</button>
		<button type="button" title="colonise" onclick="add_fleet_colonise_order_dialog()"><img src="images/colonise.png"> Colonise</button>
		<button type="button" title="Construct" onclick="add_fleet_construct_order_dialog()"><img src="images/construct.png"> Construct</button>
		<button type="button" title="Attack" onclick=""><img src="images/attack.png"> Attack</button>
		<button type="button" title="Assault" onclick=""><img src="images/assault.png"> Assault</button>
		<button type="button" title="Siege" onclick="add_fleet_siege_order()"><img src="images/siege.png"> Siege</button>
		
		<button type="button" title="Cancel All Orders" onclick="cancel_fleet_orders()"><img src="images/cancel.png"> Cancel</button>
		</p>
		
	</script>
	
	<script id="galactic_map_panel_enemy_fleet_template" type="text/ractive">		
		<h3 class="map_panel_header">Enemy Fleet ({{x}}, {{z}})</h3>
		<span style="display : inline-block; width : 90%;"><voidprogress class="fleet_health" text="{{health}}" subtext="{{max_health}}" value="{{health}}" max="{{max_health}}"></voidprogress></span>
		Attack: {{attack}}
		Defense: {{defense}}
		Damage : {{damage}}
		<h4>Ships</h4>
		{{#ships.length > 0}}			
			<table>
			{{#ships}}
			<tr>
			
			<td decorator="tooltip" data-decorator="ship-class-tooltip-{{ship_class_cache[class_id].id}}">
			<img width="16" height="16" src="images/ship.png"> {{ship_class_cache[class_id].name}} 
			</td>
			<td>	
			<span style="display : inline-block; width : 100px;"><voidprogress class="ship_health" text="{{health}}" subtext="{{max_health}}" value="{{health}}" max="{{max_health}}"></voidprogress></span>
			</td>
			</tr>
			
			{{/ships}}
			</table>
		{{/ships.length > 0}}
		{{^ships}}
			None
		{{/ships}}
	</script>
	
	<script id="galactic_map_panel_sector_template" type="text/ractive">
		<h3 class="map_panel_header">Sector {{x}}, {{z}}</h3>
		<div class="map_panel_content">
			{{#system}}
			<button class="wide_button" type="button" onclick="show_system_view({{x}}, {{z}} );"><img width="16" height="16" src="images/default.png"> View System</button>		
			{{/system}}
			
			<table class="data_block">
				{{#type_id}}
					<tr>
					<th>Type</th>
					<td decorator="tooltip" data-decorator="sector_type_tooltip">
					{{sector_class_cache[type_id].name}}
					<span class="tooltip" id="sector_type_tooltip">Movement cost: {{sector_class_cache[type_id].movement_cost}}</span>
					</td>
					</tr>
				{{/type_id}}
				
				{{#ruin}}
					<tr>
					<th>Salvage</th>
					<td>{{name}}</td>
					</tr>
				{{/ruin}}
				
				{{#upgrade_id}}
					<tr>
					<th>Upgrade</th>
					<td decorator="tooltip" data-decorator="upgrade-class-tooltip-{{upgrade_id}}">{{upgrade_class_cache[upgrade_id].name}}</td>
					</tr>
				{{/upgrade_id}}
				
				<tr> 
					<th>Owner</th>
					{{#friendly}}
					<td class="friendly" style="color : {{player.color.border}}">You</td>
					{{/friendly}}
					{{^friendly}}
						{{#enemy}}
						<td class="enemy" style="color : {{players[owner].color.border}}">{{players[owner].name}}</td>
						{{/enemy}}
						{{^enemy}}
						<td>None</td>
						{{/enemy}}
					{{/friendly}}
				</tr>
				
				{{#system.name}}
					<tr>
					<th>Name</th>
					<td>{{system.name}}</td>
					</tr>
				{{/system.name}}
								
				{{# system.planets.length > 0}}
				<tr>
					<th>Planets</th>
					<td>
					<ul class="small_planet_list">
					{{#system.planets}}	
						{{# planet_class_cache[class_id] }}
						<li class="{{#terraformed}} terraformed{{/terraformed}}{{^terraformed}}{{#terraformable}} terraformable{{/terraformable}}{{^terraformable}} unterraformable{{/terraformable}}{{/terraformed}}">
							<img decorator="tooltip" data-decorator="planet-class-tooltip-{{id}}-{{class.id}}" width="30" height="30" src="{{#terraformed}}{{image_populated}}{{/terraformed}}{{^terraformed}}{{image}}{{/terraformed}}" alt="{{name}}">
							<div class="tooltip" id="planet-class-tooltip-{{id}}-{{class.id}}">						
								<h4>{{name}}</h4>	
								{{> planet_template}}
							</div>
						</li>
						{{/planet_class_cache}}
					{{/system.planets}}
					</ul>
					</td>
				</tr>
				{{/ end of filter }}
				
				{{#system.owner}}
				
				{{#system.influence}}
				<tr>
					<th>Influence</th>
					<td>
					Level {{system.influence_level}}
					<voidprogress text="Growth in {{void.turns(system.influence_growth_turns)}}" class="influence" value="{{pool}}" max="{{system.influence_growth_threshold}}"></voidprogress>
					</td>
				</tr>
				{{/system.influence}}
				
				
				<tr>
					<th>Population</th>
					<td> 
					{{system.population}}
					<voidprogress text="Growth in {{void.turns(system.growth_turns)}}" class="food" value="{{system.food.pool}}" max="{{system.food_growth_threshold}}"></voidprogress> </td>					
				</tr>
				<tr>
					<th>Output</th>
					<td>
					<ul>
					<li><img src="images/icons/credits.png"> {{void.per_turn_value(system.credits_per_turn)}} </li>
					<li><img src="images/icons/research.png"> {{void.per_turn_value(system.research_per_turn)}} </li>
					</ul>
					</td>
				</tr>
				
				{{#friendly}}
				<tr>
					<th>Queue	
					</th>
					<td>
					
					{{#system.build_queue.items.length > 0}}
					<ul>
					{{# system.build_queue.items.0 }}

					<li>				
					{{#type == "ship"}}
						<span decorator="tooltip" data-decorator="ship-class-tooltip-{{target_id}}">
						{{ship_class_cache[target_id].name}}
						{{#purchased}}
						1 turn
						{{/purchased}}
						
						{{^purchased}}
						{{#production_per_turn}} {{void.turns(progress, production_per_turn)}} {{/production_per_turn}} 						
						{{/purchased}}
						</span>
					{{/type == "ship"}}					
					{{#type == "structure"}}
						<span decorator="tooltip" data-decorator="structure-class-tooltip-{{target_id}}">
						{{structure_class_cache[target_id].name}}
						{{#purchased}}
						1 turn
						{{/purchased}}
						
						{{^purchased}}
						{{#production_per_turn}} {{void.turns(progress, production_per_turn)}} {{/production_per_turn}} 						
						{{/purchased}}
						</span>		
					{{/type == "structure"}}								
					</li>
					{{/ system.build_queue.items.0 }}
					
					<li>{{ system.build_queue.items.length }} total items</li>
			
					</ul>
					{{/system.build_queue.items.length > 0}}
					
					{{^system.build_queue.items}}
					<p>Empty</p>
					{{/system.build_queue.items}}
					</td>
				</tr>
				
				
				{{#space_dock}}
					<tr>
					<th>Space dock (Max 3)</th>
					<td>
					{{#space_dock.fleet}}
					<ul>
					{{#space_dock.fleet.ships}}
					<li>{{ship_class_cache[class_id].name}}</li>
					{{/space_dock.fleet.ships}}
					</ul>
					{{/space_dock.fleet}}
					
					{{^space_dock.fleet}}
					<p>No Ships</p>
					{{/space_dock.fleet}}
					</td>
					</tr>
				{{/space_dock}}
				
				{{/friendly}}
				
				{{/system.owner}}
				
			</table>
						
		</div>
	</script>
	
	<script id="combat_comparison_template" type="text/ractive">
		<p style="color : red;">Damage done to you: {{incoming}}</p> 
		<p style="color : green;">Damage done to them: {{outgoing}}</p> 
		{{your_attack}}
		{{enemy_attack}}
		{{your_defense}}
		{{enemy_defense}}
	</script>
	
	<script id="planet_template" type="text/ractive">
		<img src="{{#terraformed}}{{image_populated}}{{/terraformed}}{{^terraformed}}{{image}}{{/terraformed}}" alt="{{name}}" title="{{name}}" oncontextmenu="context_menu(event, {})">
			<ul class="planet_class_output">
				<li class="food"><img src="images/icons/food.png" alt="Food" title="Food"> +{{output.food}}</li>
				<li class="production"><img src="images/icons/production.png" alt="Production" title="Production"> +{{output.production}}</li>
				<li class="research"><img src="images/icons/research.png" alt="Research" title="Research"> +{{output.research}}</li>
				<li class="credits"><img src="images/icons/credits.png" alt="Credits" title="Credits"> +{{output.credits}}</li>
			</ul>
			<li class="{{#terraformed}} terraformed{{/terraformed}}">
						
			<p>{{#terraformed}}Terraformed{{/terraformed}}{{^terraformed}}{{#terraformable}} Available{{/terraformable}}{{^terraformable}} Unavailable{{/terraformable}}{{/terraformed}}</p>
	</script>
	
	<script id="ship_class_template" type="text/ractive">			
			<h4>{{name}}</h4>
			<table class="ship_class">			
				<tr><th>Attack</th> <td>{{attack}}</td></tr>
				<tr><th>Defense</th> <td>{{defense}}</td></tr>
				<tr><th>Damage</th> <td>{{damage}}</td></tr>				
				<tr><th>Health</th> <td>{{max_health}}</td></tr>
				<tr><th>Special</th> <td>{{#special:key}}{{.}}{{/special}}</td></tr>
				<tr><th>Movement</th> <td>{{movement_capacity}}</td></tr>				
				<tr><th>Production</th> <td>{{work_required}}</td></tr>
			</table>
	</script>
	
	<script id="structure_class_template" type="text/ractive">			
			<h4>{{name}}</h4>
			
			<ul class="structure_class">				
				{{#modifiers}}
					<ul>
					{{#modifiers.production_per_turn}}
						<li class="production modifier"><img src="images/icons/production.png" alt="Production" title="Production"> Production: {{void.per_turn_value(modifiers.production_per_turn.value)}}</li>
					{{/modifiers.production_per_turn}}
					{{#modifiers.production_per_population}}
						<li class="production modifier"><img src="images/icons/production.png" alt="Production" title="Production"> Production: {{void.per_turn_value(value)}} per population {{#max}}(Max: {{max}}){{/max}}</li>
					{{/modifiers.production_per_population}}
					{{#modifiers.production_percent}}
						<li class="production modifier"><img src="images/icons/production.png" alt="Production" title="Production"> Production: {{void.per_turn_value(value)}}%</li>
					{{/modifiers.production_percent}}
					
					{{#modifiers.food_per_turn}}
						<li class="food modifier"><img src="images/icons/food.png" alt="Food" title="Food"> Food: {{void.per_turn_value(modifiers.food_per_turn.value)}}</li>					
					{{/modifiers.food_per_turn}}
					{{#modifiers.food_per_population}}
						<li class="food modifier"><img src="images/icons/food.png" alt="Food" title="Food"> Food: {{void.per_turn_value(value)}} per population {{#max}}(Max: {{max}}){{/max}}</li>
					{{/modifiers.food_per_population}}
					{{#modifiers.food_percent}}
						<li class="food modifier"><img src="images/icons/food.png" alt="Food" title="Food"> Food: {{void.per_turn_value(value)}}%</li>
					{{/modifiers.food_percent}}
					
					{{#modifiers.research_per_turn}}
						<li class="research modifier"><img src="images/icons/research.png" alt="Research" title="Research"> Research: {{void.per_turn_value(modifiers.research_per_turn.value)}}</li>
					{{/modifiers.research_per_turn}}
					{{#modifiers.research_per_population}}
						<li class="research modifier"><img src="images/icons/research.png" alt="Research" title="Research"> Research: {{void.per_turn_value(value)}} per population {{#max}}(Max: {{max}}){{/max}}</li>
					{{/modifiers.research_per_population}}
					{{#modifiers.research_percent}}
						<li class="research modifier"><img src="images/icons/research.png" alt="Research" title="Research"> Research: {{void.per_turn_value(value)}}%</li>
					{{/modifiers.research_percent}}
					
					{{#modifiers.credits_per_turn}}
						<li class="credits modifier"><img src="images/icons/credits.png" alt="Credits" title="Credits"> Credits: {{void.per_turn_value(modifiers.credits_per_turn.value)}}</li>
					{{/modifiers.credits_per_turn}}
					{{#modifiers.credits_per_population}}
						<li class="credits modifier"><img src="images/icons/credits.png" alt="Credits" title="Credits"> Credits: {{void.per_turn_value(value)}} per population {{#max}}(Max: {{max}}){{/max}}</li>
					{{/modifiers.credits_per_population}}
					{{#modifiers.credits_percent}}
						<li class="credits modifier"><img src="images/icons/credits.png" alt="Credits" title="Credits"> Credits: {{void.per_turn_value(value)}}%</li>
					{{/modifiers.credits_percent}}
					
					{{#modifiers.morale_per_turn}}
						<li class="morale modifier"><img src="images/icons/happy.png" alt="Morale" title="Morale"> Morale: {{void.per_turn_value(modifiers.morale_per_turn.value)}}</li>
					{{/modifiers.morale_per_turn}}
					{{#modifiers.morale_per_population}}
						<li class="morale modifier"><img src="images/icons/happy.png" alt="Morale" title="Morale"> Morale: {{void.per_turn_value(value)}} per population {{#max}}(Max: {{max}}){{/max}}</li>
					{{/modifiers.morale_per_population}}
					{{#modifiers.morale_percent}}
						<li class="morale modifier"><img src="images/icons/happy.png" alt="Morale" title="Morale"> Morale: {{void.per_turn_value(value)}}%</li>
					{{/modifiers.morale_percent}}
										
					{{#modifiers.influence_per_turn}}
						<li class="influence modifier"><img src="images/icons/influence.png" alt="Influence" title="Influence"> Influence: {{void.per_turn_value(modifiers.influence_per_turn.value)}}</li>
					{{/modifiers.influence_per_turn}}
					{{#modifiers.influence_per_population}}
						<li class="influence modifier"><img src="images/icons/influence.png" alt="Influence" title="Influence"> Influence: {{void.per_turn_value(value)}} per population {{#max}}(Max: {{max}}){{/max}}</li>
					{{/modifiers.influence_per_population}}
					{{#modifiers.influence_percent}}
						<li class="influence modifier"><img src="images/icons/influence.png" alt="Influence" title="Influence"> Influence: {{void.per_turn_value(value)}}%</li>
					{{/modifiers.influence_percent}}
					</ul>					
				{{/modifiers}}
			</ul>
			{{#empire_unique}}
			<p>One per empire.</p>
			{{/empire_unique}}
			{{#world_unique}}
			<p>One per galaxy.</p>
			{{/world_unique}}
	</script>
	
	<script id="upgrade_class_template" type="text/ractive">			
			<h4>{{name}}</h4>
			<ul class="structure_class">				
				{{#modifiers}}
					<ul>
					{{#modifiers.production}}
						<li class="production modifier"><img src="images/icons/production.png" alt="Production" title="Production"> {{void.per_turn_value(modifiers.production)}}</li>
					{{/modifiers.production}}
					{{#modifiers.food}}
						<li class="food modifier"><img src="images/icons/food.png" alt="Food" title="Food"> {{void.per_turn_value(modifiers.food)}}</li>					
					{{/modifiers.food}}
					{{#modifiers.research}}
						<li class="research modifier"><img src="images/icons/research.png" alt="Research" title="Research"> {{void.per_turn_value(modifiers.research)}}</li>
					{{/modifiers.research}}
					{{#modifiers.credits}}
						<li class="credits modifier"><img src="images/icons/credits.png" alt="Credits" title="Credits"> {{void.per_turn_value(modifiers.credits)}}</li>
					{{/modifiers.credits}}
					{{#modifiers.morale}}
						<li class="morale modifier"><img src="images/icons/happy.png" alt="Morale" title="Morale"> {{void.per_turn_value(modifiers.morale)}}</li>
					{{/modifiers.morale}}
					{{#modifiers.influence}}
						<li class="influence modifier"><img src="images/icons/influence.png" alt="Influence" title="Influence"> {{void.per_turn_value(modifiers.influence)}}</li>
					{{/modifiers.influence}}
					</ul>					
				{{/modifiers}}
			</ul>
	</script>
	
	<script id="power_class_template" type="text/ractive">			
			<h4>{{name}}</h4>
			<ul class="power_class">				
			<p>{{description}}</p>
			</ul>
	</script>
	
	
	<script id="sector_class_template" type="text/ractive">			
			<h4>{{name}}</h4>
			<ul class="sector_class">				
				{{#modifiers}}
					<ul>
					{{#modifiers.production}}
						<li class="production modifier"><img src="images/icons/production.png" alt="Production" title="Production"> {{void.per_turn_value(modifiers.production)}}</li>
					{{/modifiers.production}}
					{{#modifiers.food}}
						<li class="food modifier"><img src="images/icons/food.png" alt="Food" title="Food"> {{void.per_turn_value(modifiers.food)}}</li>					
					{{/modifiers.food}}
					{{#modifiers.research}}
						<li class="research modifier"><img src="images/icons/research.png" alt="Research" title="Research"> {{void.per_turn_value(modifiers.research)}}</li>
					{{/modifiers.research}}
					{{#modifiers.credits}}
						<li class="credits modifier"><img src="images/icons/credits.png" alt="Credits" title="Credits"> {{void.per_turn_value(modifiers.credits)}}</li>
					{{/modifiers.credits}}
					{{#modifiers.morale}}
						<li class="morale modifier"><img src="images/icons/happy.png" alt="Morale" title="Morale"> {{void.per_turn_value(modifiers.morale)}}</li>
					{{/modifiers.morale}}
					{{#modifiers.influence}}
						<li class="influence modifier"><img src="images/icons/influence.png" alt="Influence" title="Influence"> {{void.per_turn_value(modifiers.influence)}}</li>
					{{/modifiers.influence}}
					</ul>					
				{{/modifiers}}
			</ul>
	</script>
	
	
	<script id="system_view_colonise_template" type="text/ractive">
		<div id="system_view">
		{{#system.planets.length > 0}}		
		<ul class="system_view_planet_list">
		{{#system.planets}}
			<li onclick="void_view.set('system_view', {}); add_fleet_colonise_order('{{id}}')" class="system_view_planet class{{class.id}} selectable">
				{{# planet_class_cache[class_id]}}
				{{> planet_template}}
				{{/planet_class_cache[class_id]}}
			</li>
		{{/system.planets}}
		</ul>
		{{/system.planets.length > 0}}
		</div>
	</script>
	
	<script id="construction_template" type="text/ractive">
		<div>
			<ul>
			{{#player.available_upgrade_classes:key}}
				<li decorator="tooltip" data-decorator="upgrade-class-tooltip-{{id}}"><button onclick="add_fleet_construct_order({{id}})">{{upgrade_class_cache[id].name}}</button></li>
			{{/player.available_upgrade_classes}}
			</ul>
		</div>
	</script>
	
	<script id="system_view_template" type="text/ractive">
		<div id="system_view">
		<h2> 
		<span id="dialog_title">{{#name}}{{name}}{{/name}}{{^name}}System{{/name}} at ({{hex_selected.x}}, {{hex_selected.z}})</span>
		<button class="close_window" onclick="void_view.set('system_view', {})">Return to Map</button>
		</h2>
		{{# planets.length > 0}}		
		<ul class="system_view_planet_list">
		{{#planets}}
			<li class="system_view_planet class{{class_id}}">
				{{# planet_class_cache[class_id]}}
				{{> planet_template}}
				{{/ planet_class_cache}}
			</li>
		{{/planets}}
		</ul>
		{{/planets}}

		{{#yours}}
			<ul class="planet_output">			
			<li><img src="images/icons/food.png" alt="Food" title="Food"> {{void.per_turn_value(food.per_turn)}}</li>
			<li class="planet_output_bar">
				<voidprogress text="Growth in {{void.turns(growth_turns)}}" class="food" value="{{food.pool}}" max="{{food_growth_threshold}}"></voidprogress>
			</li>
			<li><img src="images/icons/production.png" alt="Production" title="Production"> {{void.per_turn_value(production.per_turn)}}</li>
			<li><img src="images/icons/research.png" alt="Research" title="Research"> {{void.per_turn_value(research.per_turn)}}</li>
			<li><img src="images/icons/credits.png" alt="Credits" title="Credits"> {{void.per_turn_value(credits.per_turn)}}</li>
			<li>
			<img src="images/icons/influence.png" alt="Influence" title="Influence"> {{void.per_turn_value(influence.per_turn)}}			
			</li>
			<li class="planet_output_bar">			
			<voidprogress text="Growth in {{void.turns(influence_growth_turns)}}" class="influence" value="{{influence.pool}}" max="{{influence_growth_threshold}}"></voidprogress>
			</li>
			</ul>
			
			<div class="system_view_list available_items"  decorator="custom_scroll">
			<h4>Available Ship Classes</h4>
			<ul class="selector_list">
			{{#player.available_ship_classes:key}}
				<li class="system_view_selector" decorator="tooltip" data-decorator="ship-class-tooltip-{{id}}">
					<img src="images/ship.png">
					<h4>{{name}}</h4>
					<p>
					{{#production_per_turn}} {{void.turns(work_required, production_per_turn)}} {{/production_per_turn}}
					<button type="button" onclick="build_ship('{{id}}');">Build</button>
					</p>
				</li>
				
			{{/player.available_ship_classes}}
			</ul>
			
			<h4>Available Structure Classes</h4>
			<ul class="selector_list">
			{{#available_structure_classes}}				
				
				<li class="system_view_selector" decorator="tooltip" data-decorator="structure-class-tooltip-{{id}}">
					<img src="images/structure.png">
					<h4>{{name}}</h4>
					<p>
					{{#../../production_per_turn}} {{void.turns(structure_class_cache[id].work_required, ../../production_per_turn)}} {{/../../production_per_turn}}					
					<button type="button" onclick="build_structure('{{id}}');">Build</button>
					</p>

				</li>
				
			{{/available_structure_classes}}
			</ul>
			
			
			</div>
			
			<div class="system_view_list queue_items" decorator="custom_scroll">
			<h4>System Queue</h4>
			
			{{#.}}
			<div class="selector_list">
			<ul class="selector_list" >
			{{# build_queue.items.length > 0}}
				{{#build_queue.items}}
						
				{{# type == "ship"}}
				<li class="system_view_selector" decorator="tooltip" data-decorator="ship-class-tooltip-{{target_id}}">		
				<img src="images/ship.png">
				<h4>{{ship_class_cache[target_id].name}}</h4>
				<p>
				{{#purchased}}
				1 turn
				{{/purchased}}
				
				{{^purchased}}
				{{#production_per_turn}} {{void.turns(progress, production_per_turn)}} {{/production_per_turn}} 
				<button disabled="{{#player.credits < ship_class_cache[target_id].rush_cost}}disabled{{/player}}" type="button" onclick="buy_queue_item('{{id}}', {{ship_class_cache[target_id].rush_cost}})">Rush {{ship_class_cache[target_id].rush_cost}} <img src="images/icons/credits.png"></button>
				{{/purchased}}
				</p>
				</li>
				{{/ type}}
				{{# type == "structure"}}
				<li class="system_view_selector" decorator="tooltip" data-decorator="structure-class-tooltip-{{target_id}}">		
				<img src="images/structure.png">
				<h4>{{structure_class_cache[target_id].name}}</h4>
				<p>
				{{#purchased}}
				1 turn
				{{/purchased}}
				
				{{^purchased}}
				{{#production_per_turn}} {{void.turns(progress, production_per_turn)}} {{/production_per_turn}}
				<button type="button" onclick="buy_queue_item('{{id}}', {{structure_class_cache[target_id].rush_cost}})">Rush {{structure_class_cache[target_id].rush_cost}} <img src="images/icons/credits.png"></button>
				{{/purchased}}
				</p>
				</li>
				{{/ type}}				
				
				{{/build_queue.items}}			
			{{/build_queue.items}}
			{{^build_queue.items}}
			<li>Empty</li>
			{{/build_queue.items}}
			</ul>
			</div>
			{{/.}}
			</div>
			
			<div class="system_view_list existing_items" decorator="custom_scroll">
			<h4>Structures</h4>
			{{# structures.length > 0}}
			<ul class="selector_list" >
			{{#structures}}
				<li class="system_view_selector" decorator="tooltip" data-decorator="structure-class-tooltip-{{class_id}}">
				<img src="images/structure.png">
				<h4>{{name}}</h4>
				
				</li>
				{{/structures}}
			</ul>			
			{{/structures}}
			
			{{^structures}}
			<p>None</p>
			{{/structures}}
			</div>
			
		{{/yours}}
		
		
		
		
		</div>
	</script>
	
	<script id="map_context_menu_default" type="text/x-handlebars-template">
		
		<h3>{{x}}, {{z}}</h3>
		{{#if your_fleets}}
		<h3>Fleets</h3>
		<ul class="context_menu">
			{{#each your_fleets}}<li class="context_menu_item" onclick="show_map_panel_fleet('{{id}}')">{{id}}</li>{{/each}}
		</ul>
		{{/if}}
	</script>
	
	<script id="map_context_menu_fleet_move" type="text/x-handlebars-template">
		<ul class="context_menu">
			<li class="context_menu_item" onclick="start_fleet_order()">End Fleet Move</li>
		</ul>
	</script>
	
	<div id="galactic_map_context_menu" class="context_menu_container">
		
	</div>
	
	
	<script id="system_planet_context_menu" type="text/x-handlebars-template">
		<ul class="context_menu">
			<li class="context_menu_item" onclick="terraform_planet()">Terraform</li>
		</ul>
	</script>
	
	
	
	<script id="player_resources_template" type="text/ractive">
		<span decorator="tooltip" data-decorator="player-credits-tooltip">		
		{{#player}}
		<img src="images/icons/credits.png"> {{void.value(credits.pool)}} ({{void.per_turn_value(credits.per_turn)}})    
		{{/player}}
		</span>

		<span decorator="tooltip" data-decorator="player-morale-tooltip">
    <img src="images/icons/happy.png"> 
		<span class="{{# player.morale.per_turn > 0 }}positive{{/player.morale.per_turn }}{{#player.morale.per_turn < 0 }}negative{{/player.morale.per_turn}}"> 
    {{void.per_turn_value(player.morale.per_turn)}}
   	</span>
   	{{#player.golden_age}}
   	Golden Age ({{player.golden_age}} turns)
   	{{/player.golden_age}}
   	{{^player.golden_age}}
   		({{void.value(player.morale.pool)}} / 500)
   	{{/player.golden_age}}
   	</span>
   	
   	<div class="tooltip" id="player-morale-tooltip">
			
			{{# player.morale < 0}}
			<p>Negative morale lowers your systems growth to 10% of normal</p>
			{{/ player.morale < 0}}

			{{#player.morale.sources}}
			<ul>				
				<li>Population: {{void.per_turn_value(population)}}</li>
				<li>Systems: {{void.per_turn_value(system)}}</li>
				<li>Structures: {{void.per_turn_value(structures)}}</li>
			</ul>
			{{/player.morale.sources}}
			
			{{^player.golden_age}}
				<h4>Golden Age</h4>
				{{void.turns(500, player.morale.per_turn)}} until your empire enters a golden age.
			{{/player.golden_age}}
			
				
		</div>
		
		<div class="tooltip" id="player-credits-tooltip">
			<h4>{{void.per_turn_value(player.credits.per_turn)}} per turn</h4>
			{{#player.credits.sources}}
			<ul>				
				<li>Fleet Upkeep: {{void.per_turn_value(fleet)}}</li>
				<li>Ship Upkeep: {{void.per_turn_value(ship)}}</li>
				<li>Systems: {{void.per_turn_value(system)}}</li>
			</ul>
			{{/player.credits.sources}}			
		</div>
   	
   	<span decorator="tooltip" data-decorator="player-research-tooltip">
   	<img src="images/icons/research.png"> 
   	<span class="player_research_progress"><voidprogress class="research" text="{{player.current_tech.class.name}}" subtext="{{ Math.ceil(player.current_tech.progress / player.research.per_turn) }} turns" value="{{player.current_tech.class.cost - player.current_tech.progress}}" max="{{player.current_tech.class.cost}}"></voidprogress></span>
   	</span>
   	
   	<div class="tooltip" id="player-research-tooltip">
			<h4>{{player.current_tech.class.name}}</h4>
			<p>(completed {{player.current_tech.progress}} of {{player.current_tech.class.cost}})</p>
			<h4>{{void.per_turn_value(player.research.per_turn)}} per turn.</h4>
			{{#player.research.sources}}
			<ul>
				<li>Systems: {{void.per_turn_value(system)}}</li>
			</ul>
			{{/player.research.sources}}			
		</div>
   	
	</script>
	
	
	<script id="progress_bar_template" type="text/x-handlebars-template">		
		<span class="progress_bar {{class}}_progress_bar">
			<span class="progress_bar_text">{{text}} {{#subtext}}({{subtext}}){{/subtext}}</span>
			<span class="progress_bar_inner" style="width : {{percent(value, max)}}%"></span>
		</span>
	</script>
	
	
	<script>

	</script>
	
	
</body>
</html>
